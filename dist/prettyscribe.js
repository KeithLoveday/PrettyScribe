!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){(function(t,r,n){e.exports=function e(t,r,n){function i(o,a){if(!r[o]){if(!t[o]){if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[o]={exports:{}};t[o][0].call(h.exports,(function(e){return i(t[o][1][e]||e)}),h,h.exports,e,t,r,n)}return r[o].exports}for(var s=!1,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";var n=e("./utils"),i=e("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,o,a,l,h,c=[],u=0,d=e.length,f=d,_="string"!==n.getTypeOf(e);u<e.length;)f=d-u,i=_?(t=e[u++],r=u<d?e[u++]:0,u<d?e[u++]:0):(t=e.charCodeAt(u++),r=u<d?e.charCodeAt(u++):0,u<d?e.charCodeAt(u++):0),o=t>>2,a=(3&t)<<4|r>>4,l=1<f?(15&r)<<2|i>>6:64,h=2<f?63&i:64,c.push(s.charAt(o)+s.charAt(a)+s.charAt(l)+s.charAt(h));return c.join("")},r.decode=function(e){var t,r,n,o,a,l,h=0,c=0,u="data:";if(e.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var d,f=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===s.charAt(64)&&f--,e.charAt(e.length-2)===s.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=i.uint8array?new Uint8Array(0|f):new Array(0|f);h<e.length;)t=s.indexOf(e.charAt(h++))<<2|(o=s.indexOf(e.charAt(h++)))>>4,r=(15&o)<<4|(a=s.indexOf(e.charAt(h++)))>>2,n=(3&a)<<6|(l=s.indexOf(e.charAt(h++))),d[c++]=t,64!==a&&(d[c++]=r),64!==l&&(d[c++]=n);return d}},{"./support":30,"./utils":32}],2:[function(e,t,r){"use strict";var n=e("./external"),i=e("./stream/DataWorker"),s=e("./stream/DataLengthProbe"),o=e("./stream/Crc32Probe");function a(e,t,r,n,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=n,this.compressedContent=i}s=e("./stream/DataLengthProbe"),a.prototype={getContentWorker:function(){var e=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,r){return e.pipe(new o).pipe(new s("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},t.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){"use strict";var n=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(e){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){"use strict";var n=e("./utils"),i=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==n.getTypeOf(e)?function(e,t,r,n){var s=i,o=0+r;e^=-1;for(var a=0;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}(0|t,e,e.length):function(e,t,r,n){var s=i,o=0+r;e^=-1;for(var a=0;a<o;a++)e=e>>>8^s[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length):0}},{"./utils":32}],5:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){"use strict";var n;n="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:n}},{lie:37}],7:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),s=e("./utils"),o=e("./stream/GenericWorker"),a=n?"uint8array":"array";function l(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic="\b\0",s.inherits(l,o),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(a,e.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(e){return new l("Deflate",e)},r.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){"use strict";function n(e,t){var r,n="";for(r=0;r<t;r++)n+=String.fromCharCode(255&e),e>>>=8;return n}function i(e,t,r,i,o,c){var u,d,f=e.file,_=e.compression,p=c!==a.utf8encode,m=s.transformTo("string",c(f.name)),g=s.transformTo("string",a.utf8encode(f.name)),b=f.comment,v=s.transformTo("string",c(b)),y=s.transformTo("string",a.utf8encode(b)),w=g.length!==f.name.length,S=y.length!==b.length,C="",x="",k="",A=f.dir,E=f.date,T={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(T.crc32=e.crc32,T.compressedSize=e.compressedSize,T.uncompressedSize=e.uncompressedSize);var L=0;t&&(L|=8),p||!w&&!S||(L|=2048);var Y=0,z=0;A&&(Y|=16),"UNIX"===o?(z=798,Y|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(f.unixPermissions,A)):(z=20,Y|=function(e){return 63&(e||0)}(f.dosPermissions)),u=E.getUTCHours(),u<<=6,u|=E.getUTCMinutes(),u<<=5,u|=E.getUTCSeconds()/2,d=E.getUTCFullYear()-1980,d<<=4,d|=E.getUTCMonth()+1,d<<=5,d|=E.getUTCDate(),w&&(x=n(1,1)+n(l(m),4)+g,C+="up"+n(x.length,2)+x),S&&(k=n(1,1)+n(l(v),4)+y,C+="uc"+n(k.length,2)+k);var N="";return N+="\n\0",N+=n(L,2),N+=_.magic,N+=n(u,2),N+=n(d,2),N+=n(T.crc32,4),N+=n(T.compressedSize,4),N+=n(T.uncompressedSize,4),N+=n(m.length,2),N+=n(C.length,2),{fileRecord:h.LOCAL_FILE_HEADER+N+m+C,dirRecord:h.CENTRAL_FILE_HEADER+n(z,2)+N+n(v.length,2)+"\0\0\0\0"+n(Y,4)+n(i,4)+m+C+v}}var s=e("../utils"),o=e("../stream/GenericWorker"),a=e("../utf8"),l=e("../crc32"),h=e("../signature");function c(e,t,r,n){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(c,o),c.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,o.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-n-1))/r:100}}))},c.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=i(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},c.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=i(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return h.DATA_DESCRIPTOR+n(e.crc32,4)+n(e.compressedSize,4)+n(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},c.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,i=function(e,t,r,i,o){var a=s.transformTo("string",o(i));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(e,2)+n(e,2)+n(t,4)+n(r,4)+n(a.length,2)+a}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},c.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},c.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},c.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},c.prototype.error=function(e){var t=this._sources;if(!o.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},c.prototype.lock=function(){o.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=c},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){"use strict";var n=e("../compressions"),i=e("./ZipFileWorker");r.generateWorker=function(e,t,r){var s=new i(t.streamFiles,r,t.platform,t.encodeFileName),o=0;try{e.forEach((function(e,r){o++;var i=function(e,t){var r=e||t,i=n[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,t.compression),a=r.options.compressionOptions||t.compressionOptions||{},l=r.dir,h=r.date;r._compressWorker(i,a).withStreamInfo("file",{name:e,dir:l,date:h,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(s)})),s.entriesCount=o}catch(e){s.error(e)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(n.prototype=e("./object")).loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.5.0",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e("./external"),t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){"use strict";var n=e("./utils"),i=e("./external"),s=e("./utf8"),o=(n=e("./utils"),e("./zipEntries")),a=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function h(e){return new i.Promise((function(t,r){var n=e.decompressed.getContentWorker().pipe(new a);n.on("error",(function(e){r(e)})).on("end",(function(){n.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var r=this;return t=n.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var r=new o(t);return r.load(e),r})).then((function(e){var r=[i.Promise.resolve(e)],n=e.files;if(t.checkCRC32)for(var s=0;s<n.length;s++)r.push(h(n[s]));return i.Promise.all(r)})).then((function(e){for(var n=e.shift(),i=n.files,s=0;s<i.length;s++){var o=i[s];r.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders})}return n.zipComment.length&&(r.comment=n.zipComment),r}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../stream/GenericWorker");function s(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}n.inherits(s,i),s.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){"use strict";var n=e("readable-stream").Readable;function i(e,t,r){n.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),r&&r(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}e("../utils").inherits(i,n),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,r,n){"use strict";r.exports={isNode:void 0!==t,newBufferFrom:function(e,r){if(t.from&&t.from!==Uint8Array.from)return t.from(e,r);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new t(e,r)},allocBuffer:function(e){if(t.alloc)return t.alloc(e);var r=new t(e);return r.fill(0),r},isBuffer:function(e){return t.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,r){"use strict";function n(e,t,r){var n,i=s.getTypeOf(t),a=s.extend(r||{},l);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(e=p(e)),a.createFolders&&(n=_(e))&&m.call(this,n,!0);var u,g="string"===i&&!1===a.binary&&!1===a.base64;r&&void 0!==r.binary||(a.binary=!g),(t instanceof h&&0===t.uncompressedSize||a.dir||!t||0===t.length)&&(a.base64=!1,a.binary=!0,t="",a.compression="STORE",i="string"),u=t instanceof h||t instanceof o?t:d.isNode&&d.isStream(t)?new f(e,t):s.prepareContent(e,t,a.binary,a.optimizedBinaryString,a.base64);var b=new c(e,u,a);this.files[e]=b}var i=e("./utf8"),s=e("./utils"),o=e("./stream/GenericWorker"),a=e("./stream/StreamHelper"),l=e("./defaults"),h=e("./compressedObject"),c=e("./zipObject"),u=e("./generate"),d=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),_=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},p=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},m=function(e,t){return t=void 0!==t?t:l.createFolders,e=p(e),this.files[e]||n.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function g(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var b={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,n;for(t in this.files)this.files.hasOwnProperty(t)&&(n=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,n))},filter:function(e){var t=[];return this.forEach((function(r,n){e(r,n)&&t.push(n)})),t},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,n.call(this,e,t,r),this;if(g(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var s=this.files[this.root+e];return s&&!s.dir?s:null},folder:function(e){if(!e)return this;if(g(e))return this.filter((function(t,r){return r.dir&&e.test(t)}));var t=this.root+e,r=m.call(this,t),n=this.clone();return n.root=r.name,n},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter((function(t,r){return r.name.slice(0,e.length)===e})),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=s.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");s.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var n=r.comment||this.comment||"";t=u.generateWorker(this,r,n)}catch(e){(t=new o("error")).error(e)}return new a(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=b},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===t&&this.data[s+1]===r&&this.data[s+2]===n&&this.data[s+3]===i)return s-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&r===s[1]&&n===s[2]&&i===s[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){"use strict";var n=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,r){"use strict";var n=e("./Uint8ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){"use strict";var n=e("./ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../support"),s=e("./ArrayReader"),o=e("./StringReader"),a=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new a(e):i.uint8array?new l(n.transformTo("uint8array",e)):new s(n.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../utils");function s(e){n.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(s,n),s.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../crc32");function s(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,n),s.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function s(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}n.inherits(s,i),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function s(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}n.inherits(s,i),s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){"use strict";function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=n},{}],29:[function(e,r,n){"use strict";var i=e("../utils"),s=e("./ConvertWorker"),o=e("./GenericWorker"),a=e("../base64"),l=e("../support"),h=e("../external"),c=null;if(l.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function u(e,t,r){var n=t;switch(t){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=t,this._mimeType=r,i.checkSupport(n),this._worker=e.pipe(new s(n)),e.lock()}catch(e){this._worker=new o("error"),this._worker.error(e)}}u.prototype={accumulate:function(e){return function(e,r){return new h.Promise((function(n,s){var o=[],l=e._internalType,h=e._outputType,c=e._mimeType;e.on("data",(function(e,t){o.push(e),r&&r(t)})).on("error",(function(e){o=[],s(e)})).on("end",(function(){try{var e=function(e,t,r){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),r);case"base64":return a.encode(t);default:return i.transformTo(e,t)}}(h,function(e,r){var n,i=0,s=null,o=0;for(n=0;n<r.length;n++)o+=r[n].length;switch(e){case"string":return r.join("");case"array":return Array.prototype.concat.apply([],r);case"uint8array":for(s=new Uint8Array(o),n=0;n<r.length;n++)s.set(r[n],i),i+=r[n].length;return s;case"nodebuffer":return t.concat(r);default:throw new Error("concat : unsupported type '"+e+"'")}}(l,o),c);n(e)}catch(e){s(e)}o=[]})).resume()}))}(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,(function(e){t.call(r,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,r)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},r.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==t,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),n.blob=0===s.getBlob("application/zip").size}catch(e){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(e){n.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,r){"use strict";for(var n=e("./utils"),i=e("./support"),s=e("./nodejsUtils"),o=e("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function h(){o.call(this,"utf-8 decode"),this.leftOver=null}function c(){o.call(this,"utf-8 encode")}a[254]=a[254]=1,r.utf8encode=function(e){return i.nodebuffer?s.newBufferFrom(e,"utf-8"):function(e){var t,r,n,s,o,a=e.length,l=0;for(s=0;s<a;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=i.uint8array?new Uint8Array(l):new Array(l),s=o=0;o<l;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),r<128?t[o++]=r:(r<2048?t[o++]=192|r>>>6:(r<65536?t[o++]=224|r>>>12:(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63),t[o++]=128|r>>>6&63),t[o++]=128|63&r);return t}(e)},r.utf8decode=function(e){return i.nodebuffer?n.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,i,s,o=e.length,l=new Array(2*o);for(t=r=0;t<o;)if((i=e[t++])<128)l[r++]=i;else if(4<(s=a[i]))l[r++]=65533,t+=s-1;else{for(i&=2===s?31:3===s?15:7;1<s&&t<o;)i=i<<6|63&e[t++],s--;1<s?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),n.applyFromCharCode(l)}(e=n.transformTo(i.uint8array?"uint8array":"array",e))},n.inherits(h,o),h.prototype.processChunk=function(e){var t=n.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var s=t;(t=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),t.set(s,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var o=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+a[e[r]]>t?r:t}(t),l=t;o!==t.length&&(i.uint8array?(l=t.subarray(0,o),this.leftOver=t.subarray(o,t.length)):(l=t.slice(0,o),this.leftOver=t.slice(o,t.length))),this.push({data:r.utf8decode(l),meta:e.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=h,n.inherits(c,o),c.prototype.processChunk=function(e){this.push({data:r.utf8encode(e.data),meta:e.meta})},r.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,r){"use strict";var n=e("./support"),i=e("./base64"),s=e("./nodejsUtils"),o=e("set-immediate-shim"),a=e("./external");function l(e){return e}function h(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}r.newBlob=function(e,t){r.checkSupport("blob");try{return new Blob([e],{type:t})}catch(r){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(e),n.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(e,t,r){var n=[],i=0,s=e.length;if(s<=r)return String.fromCharCode.apply(null,e);for(;i<s;)"array"===t||"nodebuffer"===t?n.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+r,s)))):n.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+r,s)))),i+=r;return n.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var t=65536,n=r.getTypeOf(e),i=!0;if("uint8array"===n?i=c.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=c.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return c.stringifyByChunk(e,n,t)}catch(e){t=Math.floor(t/2)}return c.stringifyByChar(e)}function d(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}r.applyFromCharCode=u;var f={};f.string={string:l,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return f.string.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:function(e){return h(e,s.allocBuffer(e.length))}},f.array={string:u,array:l,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},f.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:l,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},f.uint8array={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:l,nodebuffer:function(e){return s.newBufferFrom(e)}},f.nodebuffer={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return f.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:l},r.transformTo=function(e,t){if(t=t||"",!e)return t;r.checkSupport(e);var n=r.getTypeOf(t);return f[n][e](t)},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":n.nodebuffer&&s.isBuffer(e)?"nodebuffer":n.uint8array&&e instanceof Uint8Array?"uint8array":n.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!n[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)n+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return n},r.delay=function(e,t,r){o((function(){e.apply(r||null,t||[])}))},r.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},r.prepareContent=function(e,t,s,o,l){return a.Promise.resolve(t).then((function(e){return n.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=function(e){r(e.target.error)},n.readAsArrayBuffer(e)})):e})).then((function(t){var c=r.getTypeOf(t);return c?("arraybuffer"===c?t=r.transformTo("uint8array",t):"string"===c&&(l?t=i.decode(t):s&&!0!==o&&(t=function(e){return h(e,n.uint8array?new Uint8Array(e.length):new Array(e.length))}(t))),t):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),i=e("./utils"),s=e("./signature"),o=e("./zipEntry"),a=(e("./utf8"),e("./support"));function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4)===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",r=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=t-r;if(0<n)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),i=e("./utils"),s=e("./compressedObject"),o=e("./crc32"),a=e("./utf8"),l=e("./compressions"),h=e("./support");function c(e,t){this.options=e,this.loadOptions=t}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),r=e.readInt(2),n=e.readData(r),this.extraFields[t]={id:t,length:r,value:n};e.setIndex(i)},handleUTF8:function(){var e=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var s=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)||o(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)||o(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},t.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){"use strict";function n(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var i=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),o=e("./utf8"),a=e("./compressedObject"),l=e("./stream/GenericWorker");n.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var n="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var s=!this._dataBinary;s&&!n&&(t=t.pipe(new o.Utf8EncodeWorker)),!s&&n&&(t=t.pipe(new o.Utf8DecodeWorker))}catch(e){(t=new l("error")).error(e)}return new i(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof a&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<h.length;u++)n.prototype[h[u]]=c;t.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){"use strict";var r,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,o=new i(c),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),r=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){c(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(c,0)};else{var l=new e.MessageChannel;l.port1.onmessage=c,r=function(){l.port2.postMessage(0)}}var h=[];function c(){var e,t;n=!0;for(var r=h.length;r;){for(t=h,h=[],e=-1;++e<r;)t[e]();r=h.length}n=!1}t.exports=function(e){1!==h.push(e)||n||r()}}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,r){"use strict";var n=e("immediate");function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function h(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function c(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function u(e,t,r){n((function(){var n;try{n=t(r)}catch(n){return s.reject(e,n)}n===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,n)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var r=!1;function n(t){r||(r=!0,s.reject(e,t))}function i(t){r||(r=!0,s.resolve(e,t))}var o=_((function(){t(i,n)}));"error"===o.status&&n(o.value)}function _(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=h).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){throw r}))}))},h.prototype.catch=function(e){return this.then(null,e)},h.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var r=new this.constructor(i);return this.state!==l?u(r,this.state===a?e:t,this.outcome):this.queue.push(new c(r,e,t)),r},c.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){s.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},s.resolve=function(e,t){var r=_(d,t);if("error"===r.status)return s.reject(e,r.value);var n=r.value;if(n)f(e,n);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},h.resolve=function(e){return e instanceof this?e:s.resolve(new this(i),e)},h.reject=function(e){var t=new this(i);return s.reject(t,e)},h.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var o=new Array(r),a=0,l=-1,h=new this(i);++l<r;)c(e[l],l);return h;function c(e,i){t.resolve(e).then((function(e){o[i]=e,++a!==r||n||(n=!0,s.resolve(h,o))}),(function(e){n||(n=!0,s.reject(h,e))}))}},h.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,r=!1;if(!t)return this.resolve([]);for(var n,o=-1,a=new this(i);++o<t;)n=e[o],this.resolve(n).then((function(e){r||(r=!0,s.resolve(a,e))}),(function(e){r||(r=!0,s.reject(a,e))}));return a}},{immediate:36}],38:[function(e,t,r){"use strict";var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){"use strict";var n=e("./zlib/deflate"),i=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/messages"),a=e("./zlib/zstream"),l=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(o[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var c;if(c="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(r=n.deflateSetDictionary(this.strm,c)))throw new Error(o[r]);this._dict_set=!0}}function c(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}h.prototype.push=function(e,t){var r,o,a=this.strm,h=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=s.string2buf(e):"[object ArrayBuffer]"===l.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(h),a.next_out=0,a.avail_out=h),1!==(r=n.deflate(a,o))&&0!==r)return this.onEnd(r),!(this.ended=!0);0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(s.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out)))}while((0<a.avail_in||0===a.avail_out)&&1!==r);return 4===o?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==o||(this.onEnd(0),!(a.avail_out=0))},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=h,r.deflate=c,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){"use strict";var n=e("./zlib/inflate"),i=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/constants"),a=e("./zlib/messages"),l=e("./zlib/zstream"),h=e("./zlib/gzheader"),c=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(a[r]);this.header=new h,n.inflateGetHeader(this.strm,this.header)}function d(e,t){var r=new u(t);if(r.push(e,!0),r.err)throw r.msg||a[r.err];return r.result}u.prototype.push=function(e,t){var r,a,l,h,u,d,f=this.strm,_=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?f.input=s.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new i.Buf8(_),f.next_out=0,f.avail_out=_),(r=n.inflate(f,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(d="string"==typeof p?s.string2buf(p):"[object ArrayBuffer]"===c.call(p)?new Uint8Array(p):p,r=n.inflateSetDictionary(this.strm,d)),r===o.Z_BUF_ERROR&&!0===m&&(r=o.Z_OK,m=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),!(this.ended=!0);f.next_out&&(0!==f.avail_out&&r!==o.Z_STREAM_END&&(0!==f.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=s.utf8border(f.output,f.next_out),h=f.next_out-l,u=s.buf2string(f.output,l),f.next_out=h,f.avail_out=_-h,h&&i.arraySet(f.output,f.output,l,h,0),this.onData(u)):this.onData(i.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(m=!0)}while((0<f.avail_in||0===f.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(f.avail_out=0))},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=u,r.inflate=d,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},r.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){var t,r,n,i,s,o;for(t=n=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),t=i=0,r=e.length;t<r;t++)s=e[t],o.set(s,i),i+=s.length;return o}},s={arraySet:function(e,t,r,n,i){for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)},{}],42:[function(e,t,r){"use strict";var n=e("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var o=new n.Buf8(256),a=0;a<256;a++)o[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function l(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,r.string2buf=function(e){var t,r,i,s,o,a=e.length,l=0;for(s=0;s<a;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(l),s=o=0;o<l;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),r<128?t[o++]=r:(r<2048?t[o++]=192|r>>>6:(r<65536?t[o++]=224|r>>>12:(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63),t[o++]=128|r>>>6&63),t[o++]=128|63&r);return t},r.buf2binstring=function(e){return l(e,e.length)},r.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,i,s,a=t||e.length,h=new Array(2*a);for(r=n=0;r<a;)if((i=e[r++])<128)h[n++]=i;else if(4<(s=o[i]))h[n++]=65533,r+=s-1;else{for(i&=2===s?31:3===s?15:7;1<s&&r<a;)i=i<<6|63&e[r++],s--;1<s?h[n++]=65533:i<65536?h[n++]=i:(i-=65536,h[n++]=55296|i>>10&1023,h[n++]=56320|1023&i)}return l(h,n)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+o[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,s=e>>>16&65535|0,o=0;0!==r;){for(r-=o=2e3<r?2e3:r;s=s+(i=i+t[n++]|0)|0,--o;);i%=65521,s%=65521}return i|s<<16|0}},{}],44:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,i){var s=n,o=i+r;e^=-1;for(var a=i;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},{}],46:[function(e,t,r){"use strict";var n,i=e("../utils/common"),s=e("./trees"),o=e("./adler32"),a=e("./crc32"),l=e("./messages"),h=-2,c=258,u=262,d=113;function f(e,t){return e.msg=l[t],t}function _(e){return(e<<1)-(4<e?9:0)}function p(e){for(var t=e.length;0<=--t;)e[t]=0}function m(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function g(e,t){s._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,m(e.strm)}function b(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function y(e,t){var r,n,i=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,h=e.window,d=e.w_mask,f=e.prev,_=e.strstart+c,p=h[s+o-1],m=h[s+o];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(h[(r=t)+o]===m&&h[r+o-1]===p&&h[r]===h[s]&&h[++r]===h[s+1]){s+=2,r++;do{}while(h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&s<_);if(n=c-(_-s),s=_-c,o<n){if(e.match_start=t,a<=(o=n))break;p=h[s+o-1],m=h[s+o]}}}while((t=f[t&d])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function w(e){var t,r,n,s,l,h,c,d,f,_,p=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-u)){for(i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;n=e.head[--t],e.head[t]=p<=n?n-p:0,--r;);for(t=r=p;n=e.prev[--t],e.prev[t]=p<=n?n-p:0,--r;);s+=p}if(0===e.strm.avail_in)break;if(h=e.strm,c=e.window,d=e.strstart+e.lookahead,_=void 0,(f=s)<(_=h.avail_in)&&(_=f),r=0===_?0:(h.avail_in-=_,i.arraySet(c,h.input,h.next_in,_,d),1===h.state.wrap?h.adler=o(h.adler,c,_,d):2===h.state.wrap&&(h.adler=a(h.adler,c,_,d)),h.next_in+=_,h.total_in+=_,_),e.lookahead+=r,e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function S(e,t){for(var r,n;;){if(e.lookahead<u){if(w(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-u&&(e.match_length=y(e,r)),e.match_length>=3)if(n=s._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}function C(e,t){for(var r,n,i;;){if(e.lookahead<u){if(w(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-u&&(e.match_length=y(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&4096<e.strstart-e.match_start)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-3,n=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(g(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=s._tr_tally(e,0,e.window[e.strstart-1]))&&g(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}function x(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),p(this.dyn_ltree),p(this.dyn_dtree),p(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),p(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),p(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function A(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:d,e.adler=2===t.wrap?0:1,t.last_flush=0,s._tr_init(t),0):f(e,h)}function E(e){var t=A(e);return 0===t&&function(e){e.window_size=2*e.w_size,p(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0}(e.state),t}function T(e,t,r,n,s,o){if(!e)return h;var a=1;if(-1===t&&(t=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),s<1||9<s||8!==r||n<8||15<n||t<0||9<t||o<0||4<o)return f(e,h);8===n&&(n=9);var l=new k;return(e.state=l).strm=e,l.wrap=a,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,E(e)}n=[new x(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(w(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,g(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(g(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(g(e,!1),e.strm.avail_out),1)})),new x(4,4,8,4,S),new x(4,5,16,8,S),new x(4,6,32,32,S),new x(4,4,16,16,C),new x(8,16,32,32,C),new x(8,16,128,128,C),new x(8,32,128,256,C),new x(32,128,258,1024,C),new x(32,258,258,4096,C)],r.deflateInit=function(e,t){return T(e,t,8,15,8,0)},r.deflateInit2=T,r.deflateReset=E,r.deflateResetKeep=A,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?h:(e.state.gzhead=t,0):h},r.deflate=function(e,t){var r,i,o,l;if(!e||!e.state||5<t||t<0)return e?f(e,h):h;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return f(e,0===e.avail_out?-5:h);if(i.strm=e,r=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,b(i,31),b(i,139),b(i,8),i.gzhead?(b(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),b(i,255&i.gzhead.time),b(i,i.gzhead.time>>8&255),b(i,i.gzhead.time>>16&255),b(i,i.gzhead.time>>24&255),b(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),b(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(b(i,255&i.gzhead.extra.length),b(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=a(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(b(i,0),b(i,0),b(i,0),b(i,0),b(i,0),b(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),b(i,3),i.status=d);else{var u=8+(i.w_bits-8<<4)<<8;u|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(u|=32),u+=31-u%31,i.status=d,v(i,u),0!==i.strstart&&(v(i,e.adler>>>16),v(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),m(e),o=i.pending,i.pending!==i.pending_buf_size));)b(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),m(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,b(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),m(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,b(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&m(e),i.pending+2<=i.pending_buf_size&&(b(i,255&e.adler),b(i,e.adler>>8&255),e.adler=0,i.status=d)):i.status=d),0!==i.pending){if(m(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&_(t)<=_(r)&&4!==t)return f(e,-5);if(666===i.status&&0!==e.avail_in)return f(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var y=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(w(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var r,n,i,o,a=e.window;;){if(e.lookahead<=c){if(w(e),e.lookahead<=c&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&0<e.strstart&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){o=e.strstart+c;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);e.match_length=c-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=s._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}(i,t):n[i.level].func(i,t);if(3!==y&&4!==y||(i.status=666),1===y||3===y)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===y&&(1===t?s._tr_align(i):5!==t&&(s._tr_stored_block(i,0,0,!1),3===t&&(p(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),m(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(b(i,255&e.adler),b(i,e.adler>>8&255),b(i,e.adler>>16&255),b(i,e.adler>>24&255),b(i,255&e.total_in),b(i,e.total_in>>8&255),b(i,e.total_in>>16&255),b(i,e.total_in>>24&255)):(v(i,e.adler>>>16),v(i,65535&e.adler)),m(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?0:1)},r.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&t!==d&&666!==t?f(e,h):(e.state=null,t===d?f(e,-3):0):h},r.deflateSetDictionary=function(e,t){var r,n,s,a,l,c,u,d,f=t.length;if(!e||!e.state)return h;if(2===(a=(r=e.state).wrap)||1===a&&42!==r.status||r.lookahead)return h;for(1===a&&(e.adler=o(e.adler,t,f,0)),r.wrap=0,f>=r.w_size&&(0===a&&(p(r.head),r.strstart=0,r.block_start=0,r.insert=0),d=new i.Buf8(r.w_size),i.arraySet(d,t,f-r.w_size,r.w_size,0),t=d,f=r.w_size),l=e.avail_in,c=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,w(r);r.lookahead>=3;){for(n=r.strstart,s=r.lookahead-2;r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--s;);r.strstart=n,r.lookahead=2,w(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=c,e.input=u,e.avail_in=l,r.wrap=a,0},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,i,s,o,a,l,h,c,u,d,f,_,p,m,g,b,v,y,w,S,C,x,k,A;r=e.state,n=e.next_in,k=e.input,i=n+(e.avail_in-5),s=e.next_out,A=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),l=r.dmax,h=r.wsize,c=r.whave,u=r.wnext,d=r.window,f=r.hold,_=r.bits,p=r.lencode,m=r.distcode,g=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;e:do{_<15&&(f+=k[n++]<<_,_+=8,f+=k[n++]<<_,_+=8),v=p[f&g];t:for(;;){if(f>>>=y=v>>>24,_-=y,0==(y=v>>>16&255))A[s++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=p[(65535&v)+(f&(1<<y)-1)];continue t}if(32&y){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}w=65535&v,(y&=15)&&(_<y&&(f+=k[n++]<<_,_+=8),w+=f&(1<<y)-1,f>>>=y,_-=y),_<15&&(f+=k[n++]<<_,_+=8,f+=k[n++]<<_,_+=8),v=m[f&b];r:for(;;){if(f>>>=y=v>>>24,_-=y,!(16&(y=v>>>16&255))){if(0==(64&y)){v=m[(65535&v)+(f&(1<<y)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(S=65535&v,_<(y&=15)&&(f+=k[n++]<<_,(_+=8)<y&&(f+=k[n++]<<_,_+=8)),l<(S+=f&(1<<y)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=y,_-=y,(y=s-o)<S){if(c<(y=S-y)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(x=d,(C=0)===u){if(C+=h-y,y<w){for(w-=y;A[s++]=d[C++],--y;);C=s-S,x=A}}else if(u<y){if(C+=h+u-y,(y-=u)<w){for(w-=y;A[s++]=d[C++],--y;);if(C=0,u<w){for(w-=y=u;A[s++]=d[C++],--y;);C=s-S,x=A}}}else if(C+=u-y,y<w){for(w-=y;A[s++]=d[C++],--y;);C=s-S,x=A}for(;2<w;)A[s++]=x[C++],A[s++]=x[C++],A[s++]=x[C++],w-=3;w&&(A[s++]=x[C++],1<w&&(A[s++]=x[C++]))}else{for(C=s-S;A[s++]=A[C++],A[s++]=A[C++],A[s++]=A[C++],2<(w-=3););w&&(A[s++]=A[C++],1<w&&(A[s++]=A[C++]))}break}}break}}while(n<i&&s<a);n-=w=_>>3,f&=(1<<(_-=w<<3))-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<a?a-s+257:257-(s-a),r.hold=f,r.bits=_}},{}],49:[function(e,t,r){"use strict";var n=e("../utils/common"),i=e("./adler32"),s=e("./crc32"),o=e("./inffast"),a=e("./inftrees"),l=-2;function h(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function u(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(852),t.distcode=t.distdyn=new n.Buf32(592),t.sane=1,t.back=-1,0):l}function d(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,u(e)):l}function f(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?l:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,d(e))):l}function _(e,t){var r,n;return e?(n=new c,(e.state=n).window=null,0!==(r=f(e,t))&&(e.state=null),r):l}var p,m,g=!0;function b(e){if(g){var t;for(p=new n.Buf32(512),m=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(2,e.lens,0,32,m,0,e.work,{bits:5}),g=!1}e.lencode=p,e.lenbits=9,e.distcode=m,e.distbits=5}function v(e,t,r,i){var s,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),i>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(i<(s=o.wsize-o.wnext)&&(s=i),n.arraySet(o.window,t,r-i,s,o.wnext),(i-=s)?(n.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}r.inflateReset=d,r.inflateReset2=f,r.inflateResetKeep=u,r.inflateInit=function(e){return _(e,15)},r.inflateInit2=_,r.inflate=function(e,t){var r,c,u,d,f,_,p,m,g,y,w,S,C,x,k,A,E,T,L,Y,z,N,R,I,O=0,B=new n.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;12===(r=e.state).mode&&(r.mode=13),f=e.next_out,u=e.output,p=e.avail_out,d=e.next_in,c=e.input,_=e.avail_in,m=r.hold,g=r.bits,y=_,w=p,N=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;g<16;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if(2&r.wrap&&35615===m){B[r.check=0]=255&m,B[1]=m>>>8&255,r.check=s(r.check,B,2,0),g=m=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&m)){e.msg="unknown compression method",r.mode=30;break}if(g-=4,z=8+(15&(m>>>=4)),0===r.wbits)r.wbits=z;else if(z>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<z,e.adler=r.check=1,r.mode=512&m?10:12,g=m=0;break;case 2:for(;g<16;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if(r.flags=m,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=m>>8&1),512&r.flags&&(B[0]=255&m,B[1]=m>>>8&255,r.check=s(r.check,B,2,0)),g=m=0,r.mode=3;case 3:for(;g<32;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}r.head&&(r.head.time=m),512&r.flags&&(B[0]=255&m,B[1]=m>>>8&255,B[2]=m>>>16&255,B[3]=m>>>24&255,r.check=s(r.check,B,4,0)),g=m=0,r.mode=4;case 4:for(;g<16;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}r.head&&(r.head.xflags=255&m,r.head.os=m>>8),512&r.flags&&(B[0]=255&m,B[1]=m>>>8&255,r.check=s(r.check,B,2,0)),g=m=0,r.mode=5;case 5:if(1024&r.flags){for(;g<16;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}r.length=m,r.head&&(r.head.extra_len=m),512&r.flags&&(B[0]=255&m,B[1]=m>>>8&255,r.check=s(r.check,B,2,0)),g=m=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(_<(S=r.length)&&(S=_),S&&(r.head&&(z=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,c,d,S,z)),512&r.flags&&(r.check=s(r.check,c,S,d)),_-=S,d+=S,r.length-=S),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===_)break e;for(S=0;z=c[d+S++],r.head&&z&&r.length<65536&&(r.head.name+=String.fromCharCode(z)),z&&S<_;);if(512&r.flags&&(r.check=s(r.check,c,S,d)),_-=S,d+=S,z)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===_)break e;for(S=0;z=c[d+S++],r.head&&z&&r.length<65536&&(r.head.comment+=String.fromCharCode(z)),z&&S<_;);if(512&r.flags&&(r.check=s(r.check,c,S,d)),_-=S,d+=S,z)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;g<16;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if(m!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}g=m=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;g<32;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}e.adler=r.check=h(m),g=m=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=f,e.avail_out=p,e.next_in=d,e.avail_in=_,r.hold=m,r.bits=g,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){m>>>=7&g,g-=7&g,r.mode=27;break}for(;g<3;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}switch(r.last=1&m,g-=1,3&(m>>>=1)){case 0:r.mode=14;break;case 1:if(b(r),r.mode=20,6!==t)break;m>>>=2,g-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}m>>>=2,g-=2;break;case 14:for(m>>>=7&g,g-=7&g;g<32;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if((65535&m)!=(m>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&m,g=m=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(S=r.length){if(_<S&&(S=_),p<S&&(S=p),0===S)break e;n.arraySet(u,c,d,S,f),_-=S,d+=S,p-=S,f+=S,r.length-=S;break}r.mode=12;break;case 17:for(;g<14;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if(r.nlen=257+(31&m),m>>>=5,g-=5,r.ndist=1+(31&m),m>>>=5,g-=5,r.ncode=4+(15&m),m>>>=4,g-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;g<3;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}r.lens[W[r.have++]]=7&m,m>>>=3,g-=3}for(;r.have<19;)r.lens[W[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,R={bits:r.lenbits},N=a(0,r.lens,0,19,r.lencode,0,r.work,R),r.lenbits=R.bits,N){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;A=(O=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,E=65535&O,!((k=O>>>24)<=g);){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if(E<16)m>>>=k,g-=k,r.lens[r.have++]=E;else{if(16===E){for(I=k+2;g<I;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if(m>>>=k,g-=k,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}z=r.lens[r.have-1],S=3+(3&m),m>>>=2,g-=2}else if(17===E){for(I=k+3;g<I;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}g-=k,z=0,S=3+(7&(m>>>=k)),m>>>=3,g-=3}else{for(I=k+7;g<I;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}g-=k,z=0,S=11+(127&(m>>>=k)),m>>>=7,g-=7}if(r.have+S>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;S--;)r.lens[r.have++]=z}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,R={bits:r.lenbits},N=a(1,r.lens,0,r.nlen,r.lencode,0,r.work,R),r.lenbits=R.bits,N){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,R={bits:r.distbits},N=a(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,R),r.distbits=R.bits,N){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=_&&258<=p){e.next_out=f,e.avail_out=p,e.next_in=d,e.avail_in=_,r.hold=m,r.bits=g,o(e,w),f=e.next_out,u=e.output,p=e.avail_out,d=e.next_in,c=e.input,_=e.avail_in,m=r.hold,g=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;A=(O=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,E=65535&O,!((k=O>>>24)<=g);){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if(A&&0==(240&A)){for(T=k,L=A,Y=E;A=(O=r.lencode[Y+((m&(1<<T+L)-1)>>T)])>>>16&255,E=65535&O,!(T+(k=O>>>24)<=g);){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}m>>>=T,g-=T,r.back+=T}if(m>>>=k,g-=k,r.back+=k,r.length=E,0===A){r.mode=26;break}if(32&A){r.back=-1,r.mode=12;break}if(64&A){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&A,r.mode=22;case 22:if(r.extra){for(I=r.extra;g<I;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}r.length+=m&(1<<r.extra)-1,m>>>=r.extra,g-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;A=(O=r.distcode[m&(1<<r.distbits)-1])>>>16&255,E=65535&O,!((k=O>>>24)<=g);){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if(0==(240&A)){for(T=k,L=A,Y=E;A=(O=r.distcode[Y+((m&(1<<T+L)-1)>>T)])>>>16&255,E=65535&O,!(T+(k=O>>>24)<=g);){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}m>>>=T,g-=T,r.back+=T}if(m>>>=k,g-=k,r.back+=k,64&A){e.msg="invalid distance code",r.mode=30;break}r.offset=E,r.extra=15&A,r.mode=24;case 24:if(r.extra){for(I=r.extra;g<I;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}r.offset+=m&(1<<r.extra)-1,m>>>=r.extra,g-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===p)break e;if(S=w-p,r.offset>S){if((S=r.offset-S)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}C=S>r.wnext?(S-=r.wnext,r.wsize-S):r.wnext-S,S>r.length&&(S=r.length),x=r.window}else x=u,C=f-r.offset,S=r.length;for(p<S&&(S=p),p-=S,r.length-=S;u[f++]=x[C++],--S;);0===r.length&&(r.mode=21);break;case 26:if(0===p)break e;u[f++]=r.length,p--,r.mode=21;break;case 27:if(r.wrap){for(;g<32;){if(0===_)break e;_--,m|=c[d++]<<g,g+=8}if(w-=p,e.total_out+=w,r.total+=w,w&&(e.adler=r.check=r.flags?s(r.check,u,w,f-w):i(r.check,u,w,f-w)),w=p,(r.flags?m:h(m))!==r.check){e.msg="incorrect data check",r.mode=30;break}g=m=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;g<32;){if(0===_)break e;_--,m+=c[d++]<<g,g+=8}if(m!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}g=m=0}r.mode=29;case 29:N=1;break e;case 30:N=-3;break e;case 31:return-4;case 32:default:return l}return e.next_out=f,e.avail_out=p,e.next_in=d,e.avail_in=_,r.hold=m,r.bits=g,(r.wsize||w!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&v(e,e.output,e.next_out,w-e.avail_out)?(r.mode=31,-4):(y-=e.avail_in,w-=e.avail_out,e.total_in+=y,e.total_out+=w,r.total+=w,r.wrap&&w&&(e.adler=r.check=r.flags?s(r.check,u,w,e.next_out-w):i(r.check,u,w,e.next_out-w)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==y&&0===w||4===t)&&0===N&&(N=-5),N)},r.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,0},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?l:((r.head=t).done=!1,0):l},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?l:11===r.mode&&i(1,t,n,0)!==r.check?-3:v(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):l},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){"use strict";var n=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,l,h,c,u,d){var f,_,p,m,g,b,v,y,w,S=d.bits,C=0,x=0,k=0,A=0,E=0,T=0,L=0,Y=0,z=0,N=0,R=null,I=0,O=new n.Buf16(16),B=new n.Buf16(16),W=null,P=0;for(C=0;C<=15;C++)O[C]=0;for(x=0;x<l;x++)O[t[r+x]]++;for(E=S,A=15;1<=A&&0===O[A];A--);if(A<E&&(E=A),0===A)return h[c++]=20971520,h[c++]=20971520,d.bits=1,0;for(k=1;k<A&&0===O[k];k++);for(E<k&&(E=k),C=Y=1;C<=15;C++)if(Y<<=1,(Y-=O[C])<0)return-1;if(0<Y&&(0===e||1!==A))return-1;for(B[1]=0,C=1;C<15;C++)B[C+1]=B[C]+O[C];for(x=0;x<l;x++)0!==t[r+x]&&(u[B[t[r+x]]++]=x);if(b=0===e?(R=W=u,19):1===e?(R=i,I-=257,W=s,P-=257,256):(R=o,W=a,-1),C=k,g=c,L=x=N=0,p=-1,m=(z=1<<(T=E))-1,1===e&&852<z||2===e&&592<z)return 1;for(;;){for(v=C-L,w=u[x]<b?(y=0,u[x]):u[x]>b?(y=W[P+u[x]],R[I+u[x]]):(y=96,0),f=1<<C-L,k=_=1<<T;h[g+(N>>L)+(_-=f)]=v<<24|y<<16|w|0,0!==_;);for(f=1<<C-1;N&f;)f>>=1;if(0!==f?(N&=f-1,N+=f):N=0,x++,0==--O[C]){if(C===A)break;C=t[r+u[x]]}if(E<C&&(N&m)!==p){for(0===L&&(L=E),g+=k,Y=1<<(T=C-L);T+L<A&&!((Y-=O[T+L])<=0);)T++,Y<<=1;if(z+=1<<T,1===e&&852<z||2===e&&592<z)return 1;h[p=N&m]=E<<24|T<<16|g-c|0}}return 0!==N&&(h[g+N]=C-L<<24|64<<16|0),d.bits=E,0}},{"../utils/common":41}],51:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){"use strict";var n=e("../utils/common");function i(e){for(var t=e.length;0<=--t;)e[t]=0}var s=256,o=286,a=30,l=15,h=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],d=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);i(f);var _=new Array(60);i(_);var p=new Array(512);i(p);var m=new Array(256);i(m);var g=new Array(29);i(g);var b,v,y,w=new Array(a);function S(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function C(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function x(e){return e<256?p[e]:p[256+(e>>>7)]}function k(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function A(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,k(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function E(e,t,r){A(e,r[2*t],r[2*t+1])}function T(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function L(e,t,r){var n,i,s=new Array(16),o=0;for(n=1;n<=l;n++)s[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var a=e[2*i+1];0!==a&&(e[2*i]=T(s[a]++,a))}}function Y(e){var t;for(t=0;t<o;t++)e.dyn_ltree[2*t]=0;for(t=0;t<a;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function z(e){8<e.bi_valid?k(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function N(e,t,r,n){var i=2*t,s=2*r;return e[i]<e[s]||e[i]===e[s]&&n[t]<=n[r]}function R(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&N(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!N(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function I(e,t,r){var n,i,o,a,l=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],i=e.pending_buf[e.l_buf+l],l++,0===n?E(e,i,t):(E(e,(o=m[i])+s+1,t),0!==(a=h[o])&&A(e,i-=g[o],a),E(e,o=x(--n),r),0!==(a=c[o])&&A(e,n-=w[o],a)),l<e.last_lit;);E(e,256,t)}function O(e,t){var r,n,i,s=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,h=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<h;r++)0!==s[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=o[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;1<=r;r--)R(e,s,r);for(i=h;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],R(e,s,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,s[2*i]=s[2*r]+s[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,s[2*r+1]=s[2*n+1]=i,e.heap[1]=i++,R(e,s,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,s,o,a,h=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,_=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(s=0;s<=l;s++)e.bl_count[s]=0;for(h[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)p<(s=h[2*h[2*(n=e.heap[r])+1]+1]+1)&&(s=p,m++),h[2*n+1]=s,c<n||(e.bl_count[s]++,o=0,_<=n&&(o=f[n-_]),a=h[2*n],e.opt_len+=a*(s+o),d&&(e.static_len+=a*(u[2*n+1]+o)));if(0!==m){do{for(s=p-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[p]--,m-=2}while(0<m);for(s=p;0!==s;s--)for(n=e.bl_count[s];0!==n;)c<(i=e.heap[--r])||(h[2*i+1]!==s&&(e.opt_len+=(s-h[2*i+1])*h[2*i],h[2*i+1]=s),n--)}}(e,t),L(s,c,e.bl_count)}function B(e,t,r){var n,i,s=-1,o=t[1],a=0,l=7,h=4;for(0===o&&(l=138,h=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++a<l&&i===o||(a<h?e.bl_tree[2*i]+=a:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=i,h=(a=0)===o?(l=138,3):i===o?(l=6,3):(l=7,4))}function W(e,t,r){var n,i,s=-1,o=t[1],a=0,l=7,h=4;for(0===o&&(l=138,h=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++a<l&&i===o)){if(a<h)for(;E(e,i,e.bl_tree),0!=--a;);else 0!==i?(i!==s&&(E(e,i,e.bl_tree),a--),E(e,16,e.bl_tree),A(e,a-3,2)):a<=10?(E(e,17,e.bl_tree),A(e,a-3,3)):(E(e,18,e.bl_tree),A(e,a-11,7));s=i,h=(a=0)===o?(l=138,3):i===o?(l=6,3):(l=7,4)}}i(w);var P=!1;function D(e,t,r,i){A(e,0+(i?1:0),3),function(e,t,r,i){z(e),k(e,r),k(e,~r),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r)}r._tr_init=function(e){P||(function(){var e,t,r,n,i,s=new Array(16);for(n=r=0;n<28;n++)for(g[n]=r,e=0;e<1<<h[n];e++)m[r++]=n;for(m[r-1]=n,n=i=0;n<16;n++)for(w[n]=i,e=0;e<1<<c[n];e++)p[i++]=n;for(i>>=7;n<a;n++)for(w[n]=i<<7,e=0;e<1<<c[n]-7;e++)p[256+i++]=n;for(t=0;t<=l;t++)s[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,s[8]++;for(;e<=255;)f[2*e+1]=9,e++,s[9]++;for(;e<=279;)f[2*e+1]=7,e++,s[7]++;for(;e<=287;)f[2*e+1]=8,e++,s[8]++;for(L(f,287,s),e=0;e<a;e++)_[2*e+1]=5,_[2*e]=T(e,5);b=new S(f,h,257,o,l),v=new S(_,c,0,a,l),y=new S(new Array(0),u,0,19,7)}(),P=!0),e.l_desc=new C(e.dyn_ltree,b),e.d_desc=new C(e.dyn_dtree,v),e.bl_desc=new C(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,Y(e)},r._tr_stored_block=D,r._tr_flush_block=function(e,t,r,n){var i,o,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<s;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),O(e,e.l_desc),O(e,e.d_desc),a=function(e){var t;for(B(e,e.dyn_ltree,e.l_desc.max_code),B(e,e.dyn_dtree,e.d_desc.max_code),O(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*d[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==t?D(e,t,r,n):4===e.strategy||o===i?(A(e,2+(n?1:0),3),I(e,f,_)):(A(e,4+(n?1:0),3),function(e,t,r,n){var i;for(A(e,t-257,5),A(e,r-1,5),A(e,n-4,4),i=0;i<n;i++)A(e,e.bl_tree[2*d[i]+1],3);W(e,e.dyn_ltree,t-1),W(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),I(e,e.dyn_ltree,e.dyn_dtree)),Y(e),n&&z(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(m[r]+s+1)]++,e.dyn_dtree[2*x(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){A(e,2,3),E(e,256,f),function(e){16===e.bi_valid?(k(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,r){"use strict";t.exports="function"==typeof n?n:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},{}]},{},[10])(10)}).call(this,r(2).Buffer,r(0),r(6).setImmediate)},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=r(3),i=r(4),s=r(5);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return h(this,e,t,r)}function h(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|_(t,r),i=(e=a(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|f(t.length);return 0===(e=a(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?a(e,0):d(e,t);if("Buffer"===t.type&&s(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(c(t),e=a(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|f(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function _(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return M(e).length;default:if(n)return U(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return L(this,t,r);case"utf8":case"utf-8":return A(this,t,r);case"ascii":return E(this,t,r);case"latin1":case"binary":return T(this,t,r);case"base64":return k(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:b(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):b(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,r,n,i){var s,o=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,l/=2,r/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(s=r;s<a;s++)if(h(e,s)===h(t,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===l)return c*o}else-1!==c&&(s-=s-c),c=-1}else for(r+l>a&&(r=a-l),s=r;s>=0;s--){for(var u=!0,d=0;d<l;d++)if(h(e,s+d)!==h(t,d)){u=!1;break}if(u)return s}return-1}function v(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[r+o]=a}return o}function y(e,t,r,n){return F(U(t,e.length-r),e,r,n)}function w(e,t,r,n){return F(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function S(e,t,r,n){return w(e,t,r,n)}function C(e,t,r,n){return F(M(t),e,r,n)}function x(e,t,r,n){return F(function(e,t){for(var r,n,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function k(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function A(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,o,a,l,h=e[i],c=null,u=h>239?4:h>223?3:h>191?2:1;if(i+u<=r)switch(u){case 1:h<128&&(c=h);break;case 2:128==(192&(s=e[i+1]))&&(l=(31&h)<<6|63&s)>127&&(c=l);break;case 3:s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&(l=(15&h)<<12|(63&s)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(l=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&l<1114112&&(c=l)}null===c?(c=65533,u=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=u}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return h(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return c(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return u(null,e)},l.allocUnsafeSlow=function(e){return u(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=_,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?A(this,0,e):p.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),a=Math.min(s,o),h=this.slice(n,i),c=e.slice(t,r),u=0;u<a;++u)if(h[u]!==c[u]){s=h[u],o=c[u];break}return s<o?-1:o<s?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return y(this,e,t,r);case"ascii":return w(this,e,t,r);case"latin1":case"binary":return S(this,e,t,r);case"base64":return C(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function E(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function T(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function L(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=D(e[s]);return i}function Y(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function z(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,r,n,i,s){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function R(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-r,2);i<s;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function I(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-r,4);i<s;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function O(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(e,t,r,n,s){return s||O(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function W(e,t,r,n,s){return s||O(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var s=0;s<i;++s)r[s]=this[s+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||z(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||z(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||z(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||z(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||z(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||z(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||z(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||z(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||z(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},l.prototype.readInt8=function(e,t){return t||z(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||z(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||z(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||z(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||z(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||z(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||z(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||z(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||z(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):I(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<r&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):I(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return B(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return B(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return W(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return W(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,s=n-r;if(this===e&&r<t&&t<n)for(i=s-1;i>=0;--i)e[i+t]=this[i+r];else if(s<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+s),t);return s},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var o=l.isBuffer(e)?e:U(new l(e,n).toString()),a=o.length;for(s=0;s<r-t;++s)this[s+t]=o[s%a]}return this};var P=/[^+\/0-9A-Za-z-_]/g;function D(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var r;t=t||1/0;for(var n=e.length,i=null,s=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function M(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(0))},function(e,t,r){"use strict";t.byteLength=function(e){var t=h(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=h(e),o=n[0],a=n[1],l=new s(function(e,t,r){return 3*(t+r)/4-r}(0,o,a)),c=0,u=a>0?o-4:o;for(r=0;r<u;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,l[c++]=255&t);1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t);return l},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],o=0,a=r-i;o<a;o+=16383)s.push(c(e,o,o+16383>a?a:o+16383));1===i?(t=e[r-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return s.join("")};for(var n=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=o.length;a<l;++a)n[a]=o[a],i[o.charCodeAt(a)]=a;function h(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,r){for(var i,s,o=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var s,o,a=8*i-n-1,l=(1<<a)-1,h=l>>1,c=-7,u=r?i-1:0,d=r?-1:1,f=e[t+u];for(u+=d,s=f&(1<<-c)-1,f>>=-c,c+=a;c>0;s=256*s+e[t+u],u+=d,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+e[t+u],u+=d,c-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),s-=h}return(f?-1:1)*o*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var o,a,l,h=8*s-i-1,c=(1<<h)-1,u=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,_=n?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(t*l-1)*Math.pow(2,i),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&a,f+=_,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;e[r+f]=255&o,f+=_,o/=256,h-=8);e[r+f-_]|=128*p}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new s(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(7),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(0))},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i,s,o,a,l=1,h={},c=!1,u=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick((function(){_(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){_(e.data)},n=function(e){s.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(i=u.documentElement,n=function(e){var t=u.createElement("script");t.onreadystatechange=function(){_(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):n=function(e){setTimeout(_,0,e)}:(o="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&_(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),n=function(t){e.postMessage(o+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return h[l]=i,n(l),l++},d.clearImmediate=f}function f(e){delete h[e]}function _(e){if(c)setTimeout(_,0,e);else{var t=h[e];if(t){c=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{f(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(0),r(8))},function(e,t){var r,n,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,h=[],c=!1,u=-1;function d(){c&&l&&(c=!1,l.length?h=l.concat(h):u=-1,h.length&&f())}function f(){if(!c){var e=a(d);c=!0;for(var t=h.length;t;){for(l=h,h=[];++u<t;)l&&l[u].run();u=-1,t=h.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function _(e,t){this.fun=e,this.array=t}function p(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new _(e,t)),1!==h.length||c||a(f)},_.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";r.r(t);class n{constructor(){this._name="",this._range="Melee",this._type="Melee",this._str="user",this._ap="",this._damage="",this._abilities=""}}class i{constructor(){this._name="",this._table=new Map}}class s{constructor(){this._name="",this._diceRoll="",this._distance="",this._mortalWounds=""}}class o{constructor(){this._name="",this._cast="",this._deny="",this._powers="",this._other=""}}class a{constructor(){this._name="",this._manifest=0,this._range="",this._details=""}}var l;!function(e){e[e.NONE=0]="NONE",e[e.HQ=1]="HQ",e[e.TR=2]="TR",e[e.EL=3]="EL",e[e.FA=4]="FA",e[e.HS=5]="HS",e[e.FL=6]="FL",e[e.DT=7]="DT",e[e.FT=8]="FT",e[e.LW=9]="LW",e[e.AGENTS=10]="AGENTS",e[e.COMMANDER=11]="COMMANDER",e[e.LEADER=12]="LEADER",e[e.SPECIALIST=13]="SPECIALIST",e[e.NON_SPECIALIST=14]="NON_SPECIALIST"}(l||(l={}));const h=["None","HQ","Troops","Elites","Fast Attack","Heavy Support","Flyer","Dedicated Transport","Fortification","Lord of War","Agent of the Imperium","Commander","Leader","Specialist","Non-specialist"];class c{constructor(){this._name="",this._count=0,this._move='0"',this._ws="",this._bs="",this._str=4,this._toughness=4,this._wounds=1,this._attacks="",this._leadership=7,this._save="",this._weapons=[],this._psyker=null,this._psychicPowers=[],this._explosions=[]}}class u{constructor(){this._name="",this._role=l.NONE,this._factions=new Set,this._keywords=new Set,this._abilities=new Map,this._rules=new Map,this._models=[],this._points=0,this._powerLevel=0,this._commandPoints=0,this._woundTracker=[],this._profileTables=new Map}}class d{constructor(){this._catalog="",this._name="Unknown",this._faction="Unknown",this._rules=new Map,this._units=[]}}class f{constructor(){this._powerLevel=0,this._commandPoints=0,this._points=0,this._name="",this._forces=[]}}function _(e,t=!0){var r;if(e){var n=e.querySelector("roster");if(n){const i=new f,s=null===(r=n.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue;return i._name=s||"40k Army Roster",function(e,t){var r,n,i=e.querySelectorAll("roster>costs>cost");for(let e of i)if(e.hasAttribute("name")&&e.hasAttribute("value")){let i=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,s=null===(n=e.getAttributeNode("value"))||void 0===n?void 0:n.nodeValue;s&&(" PL"==i?t._powerLevel=+s:"pts"===i?t._points=+s:"CP"===i&&(t._commandPoints=+s))}}(e,i),function(e,t,r){var n,i,s,o=e.querySelectorAll("roster>forces>force");for(let e of o)if(e.hasAttribute("name")&&e.hasAttribute("catalogueName")){let o=new d,h=null===(n=e.getAttributeNode("name"))||void 0===n?void 0:n.nodeValue,c=null===(i=e.getAttributeNode("catalogueName"))||void 0===i?void 0:i.nodeValue;if(h&&(o._name=h),c&&(o._catalog=c),!p(o,t)){var a=e.querySelectorAll("force>rules>rule");for(let e of a)if(e.hasAttribute("name")){let t=null===(s=e.getAttributeNode("name"))||void 0===s?void 0:s.nodeValue;var l=e.querySelector("rule>description");t&&l&&o._rules.set(t,l.textContent)}}m(e,o,r),t._forces.push(o)}}(e,i,t),i}}return null}function p(e,t){if(!t||!e)return!1;for(let r of t._forces)if(r._catalog===e._catalog)return!0;return!1}function m(e,t,r){var n=e.querySelectorAll("force>selections>selection");for(let e of n){var i=y(e,r);i&&i._role!=l.NONE&&t._units.push(i)}t._units.sort((e,t)=>e._role>t._role?1:e._role==t._role?0:-1)}function g(e){switch(e){case"HQ":return l.HQ;case"Troops":return l.TR;case"Elites":return l.EL;case"Fast Attack":return l.FA;case"Heavy Support":return l.HS;case"Flyer":return l.FL;case"Dedicated Transport":return l.DT;case"Fortification":return l.FT;case"Lord of War":return l.LW;case"Agent of the Imperium":return l.AGENTS}return l.NONE}function b(e){switch(e){case"Commander":return l.COMMANDER;case"Leader":return l.LEADER;case"Specialist":return l.SPECIALIST;case"Non-specialist":return l.NON_SPECIALIST}return l.NONE}function v(e,t){var r,n;let i=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,s=null===(n=e.getAttributeNode("typeName"))||void 0===n?void 0:n.nodeValue;console.log("Unknown profile type: "+s+" with name: "+i+".  Found in unit: "+t._name)}function y(e,t){var r,h,d,f,_,p,m,y,w,S,C,x,k,A,E,T,L,Y,z=new u,N=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue;N&&(z._name=N);var R=e.querySelectorAll(":scope categories>category");for(let e of R){let r=null===(h=e.getAttributeNode("name"))||void 0===h?void 0:h.nodeValue;if(r){const e="Faction: ",n=r.lastIndexOf(e);if(n>=0){const t=r.slice(n+e.length);z._factions.add(t)}else{const e=r.trim();var I=g(e);I!=l.NONE?z._role=I:t?z._keywords.add(r):(I=b(e))!=l.NONE?z._role=I:z._keywords.add(r)}}}var O=e.querySelectorAll(":scope profiles>profile");for(let e of O){let t=null===(d=e.getAttributeNode("name"))||void 0===d?void 0:d.nodeValue,r=null===(f=e.getAttributeNode("typeName"))||void 0===f?void 0:f.nodeValue;if(t&&r&&("Unit"===r||"Model"===r)){var B=new c;B._name=t;let r=e.querySelectorAll("characteristics>characteristic");for(let t of r){let r=null===(_=t.getAttributeNode("name"))||void 0===_?void 0:_.nodeValue;if(r&&t.textContent)switch(r){case"M":B._move=t.textContent;break;case"WS":B._ws=t.textContent;break;case"BS":B._bs=t.textContent;break;case"S":B._str=+t.textContent;break;case"T":B._toughness=+t.textContent;break;case"W":B._wounds=+t.textContent;break;case"A":B._attacks=t.textContent;break;case"Ld":B._leadership=+t.textContent;break;case"Save":B._save=t.textContent}if(e.parentElement&&e.parentElement.parentElement){let t=null===(p=e.parentElement.parentElement.getAttributeNode("number"))||void 0===p?void 0:p.nodeValue;t&&(B._count=+t)}}z._models.push(B)}}for(let e of O){let t=null===(m=e.getAttributeNode("name"))||void 0===m?void 0:m.nodeValue,r=null===(y=e.getAttributeNode("typeName"))||void 0===y?void 0:y.nodeValue;if(t&&r)if("Abilities"===r||"Wargear"===r||"Ability"===r||"Household Tradition"===r||"Warlord Trait"===r||"Astra Militarum Orders"===r||"Tank Orders"===r||"Lethal Ambush"==r){let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(w=e.getAttributeNode("name"))||void 0===w?void 0:w.nodeValue;r&&e.textContent&&t&&("Description"!==r&&"Ability"!==r&&"Effect"!=r||z._abilities.set(t,e.textContent))}}else if("Weapon"===r){let r=new n;r._name=t;let i=e.querySelectorAll("characteristics>characteristic");for(let e of i){let t=null===(S=e.getAttributeNode("name"))||void 0===S?void 0:S.nodeValue;if(t&&e.textContent)switch(t){case"Range":r._range=e.textContent;break;case"Type":r._type=e.textContent;break;case"S":r._str=e.textContent;break;case"AP":r._ap=e.textContent;break;case"D":r._damage=e.textContent;break;case"Abilities":r._abilities=e.textContent}}z._models.length?z._models[z._models.length-1]._weapons.push(r):console.log("Unexpected: Created a weapon without an active model.  Unit: "+N)}else if(r.includes("Wound Track")||r.includes("Stat Damage")){let r=new i;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let n=null===(C=e.getAttributeNode("name"))||void 0===C?void 0:C.nodeValue;n&&t&&(e.textContent?r._table.set(n,e.textContent):r._table.set(n,"-"))}z._woundTracker.push(r)}else if("Transport"==r){let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(x=e.getAttributeNode("name"))||void 0===x?void 0:x.nodeValue;r&&e.textContent&&t&&"Capacity"===r&&z._abilities.set(t,e.textContent)}}else if("Psychic Power"==r){let r=new a;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let t=null===(k=e.getAttributeNode("name"))||void 0===k?void 0:k.nodeValue;if(t&&e.textContent)switch(t){case"Range":r._range=e.textContent;break;case"Warp Charge":r._manifest=+e.textContent;break;case"Details":r._details=e.textContent}}z._models.length?z._models[z._models.length-1]._psychicPowers.push(r):console.log("Unexpected: Created a psychic power without an active model.  Unit: "+N)}else if(r.includes("Explosion")){let r=new s;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let t=null===(A=e.getAttributeNode("name"))||void 0===A?void 0:A.nodeValue;if(t&&e.textContent)switch(t){case"Dice Roll":r._diceRoll=e.textContent;break;case"Distance":r._distance=e.textContent;break;case"Mortal Wounds":r._mortalWounds=e.textContent}}z._models.length?z._models[z._models.length-1]._explosions.push(r):console.log("Unexpected: Created an explosion without an active model.  Unit: "+N)}else if("Psyker"==r){let r=new o;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let t=null===(E=e.getAttributeNode("name"))||void 0===E?void 0:E.nodeValue;if(t&&e.textContent)switch(t){case"Cast":r._cast=e.textContent;break;case"Deny":r._deny=e.textContent;break;case"Powers Known":r._powers=e.textContent;break;case"Other":r._other=e.textContent}}z._models.length?z._models[z._models.length-1]._psyker=r:console.log("Unexpected: Created a psyker without an active model.  Unit: "+N)}else"Unit"===r||"Model"===r||v(e,z)}var W=e.querySelectorAll(":scope costs>cost");for(let e of W)if(e.hasAttribute("name")&&e.hasAttribute("value")){let t=null===(T=e.getAttributeNode("name"))||void 0===T?void 0:T.nodeValue,r=null===(L=e.getAttributeNode("value"))||void 0===L?void 0:L.nodeValue;r&&(" PL"==t?z._powerLevel+=+r:"pts"==t?z._points+=+r:"CP"==t&&(z._commandPoints+=+r))}var P=e.querySelectorAll(":scope rules > rule");for(let e of P)if(e.hasAttribute("name")){let t=null===(Y=e.getAttributeNode("name"))||void 0===Y?void 0:Y.nodeValue;var D=e.querySelector("description");t&&D&&D.textContent&&z._rules.set(t,D.textContent)}return z}var w,S;function C(e,t,r,n,i,s,o){if(e&&t.length){e.textBaseline="top";let a=e.measureText(t);const l=a.width,h=a.actualBoundingBoxDescent-a.actualBoundingBoxAscent;o==w.Center?e.fillText(t,r+Math.max((i-l)/2,0),n+(s-h)/2,i):o==w.Left?e.fillText(t,r,n+(s-h)/2,i):o==w.Right&&e.fillText(t,r+i-l,n+(s-h)/2,i)}}function x(e,t,r,n,i){let s=n;if(e&&t.length){let n=[],o=[];e.textBaseline="top";let a=0;const l=e.measureText(" ").width,h=e.measureText(t),c=1.2*(h.actualBoundingBoxDescent-h.actualBoundingBoxAscent);t.split(" ").forEach((function(t){const r=e.measureText(t);a+r.width>i&&(n.push(o.join(" ")),o.length=0,a=0),a+=r.width+l,o.push(t)})),o.length>0&&n.push(o.join(" "));for(let t of n)e.fillText(t,r,s),s+=c}return s}!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center"}(w||(w={}));class k{constructor(e){this._descriptionStartX=190,this._descriptionWidth=600,this._showWoundBoxes=!0,this._roster=null,this._currentX=0,this._currentY=0,this._maxWidth=0,this._maxHeight=0,this._octagon=null,this._roles=new Map,this._unitLabelWidthsNormalized=[.3,.077,.077,.077,.077,.077,.077,.077,.077,.077],this._weaponLabelWidthNormalized=[.3,.077,.077,.077,.077,.077,.3],this._spellLabelWidthNormalized=[.3,.1,.1,.5],this._explosionLabelWidthNormalized=[.3,.15,.15,.15],this._trackerLabelWidth=[.3,.2,.15,.15,.15],this._roster=e,this._octagon=document.getElementById("octagon"),this._roles.set(l.HQ,document.getElementById("role_hq")),this._roles.set(l.TR,document.getElementById("role_tr")),this._roles.set(l.EL,document.getElementById("role_el")),this._roles.set(l.FA,document.getElementById("role_fa")),this._roles.set(l.HS,document.getElementById("role_hs")),this._roles.set(l.FL,document.getElementById("role_fl")),this._roles.set(l.DT,document.getElementById("role_dt")),this._roles.set(l.FT,document.getElementById("role_ft")),this._roles.set(l.LW,document.getElementById("role_lw"))}render(e,t,r){if(null!=this._roster){e&&(e.innerHTML="<h3>"+this._roster._name+" ("+this._roster._points+" pts, "+this._roster._powerLevel+" PL, "+this._roster._commandPoints+" CP)</h3>");for(let e of this._roster._forces){const n=document.createElement("div");n&&(n.innerHTML="<p>"+e._catalog+" "+e._name+"</p>"),t&&t.appendChild(n);const i=document.createElement("table");i.classList.add("table"),i.classList.add("table-sm"),i.classList.add("table-striped");const s=document.createElement("thead");i.appendChild(s),s.classList.add("thead-light");const o=document.createElement("tr");s.appendChild(o);[{name:"NAME",w:"25%"},{name:"ROLE",w:"20%"},{name:"MODELS",w:"25%"},{name:"POINTS",w:"15%"},{name:"POWER",w:"15%"}].forEach(e=>{let t=document.createElement("th");t.scope="col",t.innerHTML=e.name,t.style.width=e.w,o.appendChild(t)}),n.appendChild(i);let a=document.createElement("tbody");i.appendChild(a);for(let t of e._units){let e=document.createElement("tr"),r=document.createElement("td");r.innerHTML=t._name;let n=document.createElement("td");n.innerHTML=h[t._role];let i=document.createElement("td");i.innerHTML="";let s=0;for(const e of t._models)e._count>1?i.innerHTML+=e._count+" "+e._name:i.innerHTML+=e._name,s++,s!=t._models.length&&(i.innerHTML+=",  ");let o=document.createElement("td");o.innerHTML=t._points.toString();let l=document.createElement("td");l.innerHTML=t._powerLevel.toString(),e.appendChild(r),e.appendChild(n),e.appendChild(i),e.appendChild(o),e.appendChild(l),a.appendChild(e)}if(e._rules.size>0){let t=document.createElement("div"),n=document.createElement("h3");t.appendChild(n),n.textContent=e._catalog+" Allegiance Rules";for(let r of e._rules){let e=document.createElement("div"),n=document.createElement("h4");n.textContent=r[0];let i=document.createElement("p");i.textContent=r[1],e.appendChild(n),e.appendChild(i),t.appendChild(e)}r&&r.appendChild(t)}for(let t of e._units){let e=document.createElement("canvas");e.width=5.5*k._res,e.height=12*k._res,this._descriptionWidth=e.width-this._descriptionStartX-10;const n=this.renderUnit(t,e,0,0),i=25;let s=document.createElement("canvas");s.width=n[0]+2*i,s.height=n[1]+2*i;let o=s.getContext("2d");if(null==o||o.drawImage(e,i,i),r){let e=document.createElement("div");e.appendChild(s),r.appendChild(e)}}}}}renderBorder(e,t,r,n,i){e.strokeStyle=k._blackColor,e.beginPath(),e.moveTo(t,r+k._bevelSize),e.lineTo(t,r+i-k._bevelSize),e.lineTo(t+k._bevelSize,r+i),e.lineTo(t+n-k._bevelSize,r+i),e.lineTo(t+n,r+i-k._bevelSize),e.lineTo(t+n,r+k._bevelSize),e.lineTo(t+n-k._bevelSize,r),e.lineTo(t+k._bevelSize,r),e.closePath(),e.stroke(),e.save(),e.fillStyle=k._fillColor,e.globalCompositeOperation="destination-over",e.beginPath(),e.moveTo(t,r+k._bevelSize),e.lineTo(t,r+i-k._bevelSize),e.lineTo(t+k._bevelSize,r+i),e.lineTo(t+n-k._bevelSize,r+i),e.lineTo(t+n,r+i-k._bevelSize),e.lineTo(t+n,r+k._bevelSize),e.lineTo(t+n-k._bevelSize,r),e.lineTo(t+k._bevelSize,r),e.closePath(),e.fill(),e.restore()}renderWatermark(e){}renderLine(e){e.lineWidth=2,e.strokeStyle=k._blackColor,e.beginPath(),e.moveTo(this._currentX,this._currentY),e.lineTo(this._currentX+this._maxWidth,this._currentY),e.stroke(),this._currentY+=1}renderTableHeader(e,t,r){let n=this._currentX;const i=this._maxWidth;e.fillStyle=k._grey1,e.fillRect(this._currentX,this._currentY,i,22),e.fillStyle=k._blackColor,e.font="14px sans-serif";var s=50;if(t){e.font="12px sans-serif";for(let i=0;i<t.length;i++)r&&(s=r[i]),C(e,t[i],n,this._currentY,s,22,w.Center),n+=s}this._currentY+=22}renderSpells(e,t,r){e.font="12px sans-serif";let n=0,i=50;e.save();for(const s of t){let t=0,o=this._currentX,a=this._currentX,l=this._currentY;e.fillStyle=k._blackColor,r&&(i=r[t++]),C(e,s._name.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._manifest.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._range.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),this._currentY+=4,this._currentY=x(e,s._details,o,this._currentY,i),this._currentY+=2,o+=i,e.save(),e.fillStyle=n%2?k._greyLight:"#ffffff",e.globalCompositeOperation="destination-over";const h=this._currentY-l;e.fillRect(a,l,this._maxWidth,h),n++,e.restore()}e.restore()}renderExplosion(e,t,r){e.font="12px sans-serif";let n=0,i=50;for(const s of t){let t=0,o=this._currentX;e.fillStyle=n%2?k._greyLight:"#ffffff",e.fillRect(o,this._currentY,this._maxWidth,22),n++,e.fillStyle=k._blackColor,r&&(i=r[t++]),C(e,s._name,o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._diceRoll,o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._distance,o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._mortalWounds,o,this._currentY,i,22,w.Center),o+=i,this._currentY+=22}}renderWeapons(e,t,r){e.font="12px sans-serif";e.save();let n=0,i=50;for(const s of t){let t=0,o=this._currentX,a=this._currentX,l=this._currentY;e.fillStyle=k._blackColor,r&&(i=r[t++]),C(e,s._name.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._range.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._type.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._str.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._ap.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._damage.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),s._abilities?(this._currentY+=4,this._currentY=x(e,s._abilities,o,this._currentY,i),this._currentY+=2):this._currentY+=22,o+=i,e.save(),e.globalCompositeOperation="destination-over";const h=this._currentY-l;e.fillStyle=n%2?k._greyLight:"#ffffff",e.fillRect(a,l,this._maxWidth,h),n++,e.restore()}e.restore()}renderModel(e,t,r,n){let i=50,s=this._currentX,o=0;e.fillStyle=n%2?k._greyLight:"#ffffff",e.fillRect(s,this._currentY,this._maxWidth,24),e.fillStyle=k._blackColor,e.font="12px sans-serif",r&&(i=r[o++]),C(e,t._name.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._move.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._ws.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._bs.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._str.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._toughness.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._wounds.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._attacks.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._leadership.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._save.toString(),s,this._currentY,i,24,w.Center),s+=i,this._currentY+=24}renderAbilities(e,t){e.font="14px sans-serif",C(e,"ABILITIES",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";for(let r of t._abilities){const t=r[0].toUpperCase(),n=r[1];this._currentY+=2,this._currentY=x(e,t+": "+n,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2}}renderRules(e,t){e.font="14px sans-serif",C(e,"RULES",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";for(let r of t._rules){const t=r[0].toUpperCase(),n=r[1];this._currentY+=2,this._currentY=x(e,t+": "+n,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=4}}renderKeywords(e,t){e.font="14px sans-serif",C(e,"KEYWORDS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";const r=[...t._keywords].join(", ").toLocaleUpperCase();this._currentY+=2,this._currentY=x(e,r,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2}renderFactions(e,t){e.font="14px sans-serif",C(e,"FACTIONS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";const r=[...t._factions].join(", ").toLocaleUpperCase();this._currentY+=2,this._currentY=x(e,r,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2}renderWoundTable(e,t,r){let n=50,i=!0;for(let s of t._woundTracker){if(i&&4==t._woundTracker.length){i=!1;continue}let o=this._currentX,a=0;e.fillStyle=k._greyLight,e.fillRect(o,this._currentY,this._maxWidth,22),e.fillStyle=k._blackColor,e.font="12px sans-serif",r&&(n=r[a++]),o+=n;for(let t of s._table)r&&(n=r[a++]),C(e,t[1],o,this._currentY,n,22,w.Center),o+=n;this._currentY+=22}}renderModelList(e,t){e.font="14px sans-serif",C(e,"MODELS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";let r="",n=0;for(const e of t)e._count>1?r+=e._count+" "+e._name:r+=e._name,n++,n!=t.length&&(r+=",  ");this._currentY+=2,this._currentY=x(e,r,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2}renderWoundBoxes(e,t){e.font="14px sans-serif",C(e,"WOUNDS",this._currentX+20,this._currentY,100,16,w.Left);const r=this._currentX+this._descriptionStartX,n=r+195;e.save();for(let i of t)if(i._wounds>1){let t=this._currentY;e.font="12px serif",e.fillStyle=k._blackColor,this._currentY=x(e,i._name,r,this._currentY+3,195);let s=this._currentX+n;e.strokeStyle=k._blackColor,e.fillStyle="#ffffff";for(let r=0;r<i._wounds;r++)r%15==0&&0!=r&&(t+=25,s=this._currentX+n),e.fillRect(s,t,20,20),e.strokeRect(s,t,20,20),s+=25;t+=25,this._currentY=Math.max(this._currentY,t)}e.restore()}renderUnit(e,t,r,n){let i=t.getContext("2d");if(!i)return[0,0];this._currentX=r+k._margin,this._currentY=n+k._margin,this._maxWidth=t.width-this._currentX,this._maxHeight=Math.max(0,t.height-this._currentY),this.renderHeader(e,i),i.fillStyle=k._blackColor;let s=[],o=[],a=[],l=[],h=[];const c=[];for(var u of(this._unitLabelWidthsNormalized.forEach(e=>{c.push(e*this._maxWidth)}),e._models)){h.push(u);for(let e of u._weapons)s.push(e);for(let e of u._psychicPowers)o.push(e);for(let e of u._explosions)a.push(e);u._psyker&&l.push(u._psyker)}const d=[],f=new Map;for(const e of h)f.has(e._name)||(f.set(e._name,e),d.push(e));this.renderTableHeader(i,k._unitLabels,c);let _=0;for(var u of d)this.renderModel(i,u,c,_%2),_++;const p=[],m=new Map;for(const e of s)m.has(e._name)||(m.set(e._name,e),p.push(e));if(p.length>0){const e=[];this._weaponLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,k._weaponLabels,e),this.renderWeapons(i,p,e)}if(o.length>0){const e=[];this._spellLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,k._spellLabels,e),this.renderSpells(i,o,e)}if(e._abilities.size>0&&(this.renderLine(i),this._currentY+=2,this.renderAbilities(i,e)),l.length>0&&(this.renderLine(i),this._currentY+=2,this.renderPsykers(i,l)),e._rules.size>0&&(this.renderLine(i),this._currentY+=2,this.renderRules(i,e)),e._factions.size>0&&(this.renderLine(i),this._currentY+=2,this.renderFactions(i,e)),e._keywords.size>0&&(this.renderLine(i),this._currentY+=2,this.renderKeywords(i,e)),e._models.length>0&&(this.renderLine(i),this._currentY+=2,this.renderModelList(i,d)),e._woundTracker.length>0){this._currentY+=2,this.renderLine(i);const t=[];this._trackerLabelWidth.forEach(e=>{t.push(e*this._maxWidth)});let r=k._trackerLabels;if(4==e._woundTracker.length){let t=1;for(let n of e._woundTracker[0]._table.values())r[t++]=n}else if(3==e._woundTracker.length){let t=1;for(let n of e._woundTracker[0]._table.keys())r[t++]=n}this.renderTableHeader(i,r,t),this.renderWoundTable(i,e,t)}if(a.length>0){this._currentY+=2,this.renderLine(i);const e=[];this._explosionLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderTableHeader(i,k._explosionLabels,e),this.renderExplosion(i,a,e)}if(this._showWoundBoxes){let t=!1;for(let r of e._models)r._wounds>2&&(t=!0);t&&(this.renderLine(i),this._currentY+=5,this.renderWoundBoxes(i,e._models))}this._currentY+=2;const g=this._currentY-(n+k._margin),b=this._maxWidth;return this.renderBorder(i,this._currentX,n+k._margin,b,g),this.renderWatermark(i),[this._maxWidth,this._currentY]}renderHeader(e,t){t.globalAlpha=1,t.fillStyle=k._blackColor;const r=this._currentX,n=this._currentX+this._maxWidth,i=this._currentY,s=i+36;t.beginPath(),t.moveTo(r,i+k._bevelSize),t.lineTo(r,s),t.lineTo(n,s),t.lineTo(n,i+k._bevelSize),t.lineTo(n-k._bevelSize,i),t.lineTo(r+k._bevelSize,i),t.closePath(),t.fill();let o=r+6;if(this._octagon){t.drawImage(this._octagon,o,i+2,32,32);const r=this._roles.get(e._role);r&&t.drawImage(r,o+4,i+2+4,24,24),t.fillStyle="white",t.font="18px serif",o+=34,t.drawImage(this._octagon,o,i+2,32,32),C(t,e._powerLevel.toString(),o,i+2,32,32,w.Center),o+=34,t.drawImage(this._octagon,o,i+2,32,32),C(t,e._points.toString(),o,i+2,32,32,w.Center)}let a=0,l=28;const h=o+6;t.font=l+"px bold serif";const c=e._name.toLocaleUpperCase();let u=t.measureText(c);const d=this._maxWidth-h;for(;a<6&&u.width>d;)a+=1,l-=2,t.font=l+"px bold serif",u=t.measureText(c);t.fillStyle="white",t.textBaseline="top",C(t,c,h,i,d,36,w.Center),this._currentY+=36}renderPsykers(e,t){e.font="14px sans-serif",C(e,"PSYKERS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif",this._currentY+=2;for(let r of t)this._currentY=x(e,"CAST: "+r._cast,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2,this._currentY=x(e,"DENY: "+r._deny,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2,this._currentY=x(e,"POWERS KNOWN: "+r._powers,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2,r._other&&(this._currentY=x(e,"OTHER: "+r._other,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2)}}k._res=144,k._margin=0,k._bevelSize=15,k._blackColor="#1d272a",k._grey1="#b3bbb5",k._greyLight="#dde1df",k._fillColor="#f6f6f6",k._unitLabels=["MODEL","M","WS","BS","S","T","W","A","LD","SAVE"],k._weaponLabels=["WEAPONS","RANGE","TYPE","S","AP","D","ABILITIES"],k._spellLabels=["PSYCHIC POWER","MANIFEST","RANGE","DETAILS"],k._explosionLabels=["EXPLOSION","DICE ROLL","DISTANCE","MORTAL WOUNDS"],k._trackerLabels=["WOUND TRACK","REMAINING W","ATTRIBUTE","ATTRIBUTE","ATTRIBUTE"];class A{constructor(){this._name="",this._range="Melee",this._str="user",this._ap="",this._type="Melee"}}class E{constructor(){this._name="",this._masteryLevel="",this._disciplines=""}}class T{constructor(){this._name="",this._warpCharge=0,this._category="",this._range="",this._details=""}}!function(e){e[e.NONE=0]="NONE",e[e.HQ=1]="HQ",e[e.TR=2]="TR",e[e.EL=3]="EL",e[e.FA=4]="FA",e[e.HS=5]="HS",e[e.FL=6]="FL",e[e.DT=7]="DT",e[e.FT=8]="FT",e[e.LW=9]="LW"}(S||(S={}));const L=["None","HQ","Troops","Elites","Fast Attack","Heavy Support","Flyer","Dedicated Transport","Fortification","Lord of War"];class Y{constructor(){this._name="",this._bs="",this._front=4,this._side=4,this._rear=4,this._hp=1,this._type="",this._weapons=[]}}class z{constructor(){this._name="",this._ws="",this._bs="",this._str=4,this._front=4,this._side=4,this._rear=4,this._initiative=1,this._attacks="",this._hp=1,this._type="",this._weapons=[]}}class N{constructor(){this._name="",this._bs="",this._front=4,this._side=4,this._rear=4,this._hp=1,this._type="",this._role="",this._pursuit="",this._agility="",this._weapons=[]}}class R{constructor(){this._name="",this._count=0,this._ws="",this._bs="",this._str=4,this._toughness=4,this._wounds=1,this._initiative=1,this._attacks="",this._leadership=7,this._save="",this._weapons=[],this._psyker=null,this._psychicPowers=[]}}class I{constructor(){this._name="",this._role=S.NONE,this._factions=new Set,this._keywords=new Set,this._abilities=new Map,this._rules=new Map,this._models=[],this._walkers=[],this._vehicles=[],this._flyers=[],this._points=0}}class O{constructor(){this._catalog="",this._name="Unknown",this._faction="Unknown",this._rules=new Map,this._units=[]}}class B{constructor(){this._commandPoints=0,this._points=0,this._name="",this._forces=[]}}function W(e){var t;if(e){let r=e.querySelector("roster");if(r){const n=new B,i=null===(t=r.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue;return n._name=i||"30k Army Roster",function(e,t){var r,n;let i=e.querySelectorAll("roster>costs>cost");for(let e of i)if(e.hasAttribute("name")&&e.hasAttribute("value")){let i=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,s=null===(n=e.getAttributeNode("value"))||void 0===n?void 0:n.nodeValue;s&&("pts"===i?t._points=+s:"CP"===i&&(t._commandPoints=+s))}}(e,n),function(e,t){var r,n,i;let s=e.querySelectorAll("roster>forces>force");for(let e of s)if(e.hasAttribute("name")&&e.hasAttribute("catalogueName")){let s=new O,o=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,a=null===(n=e.getAttributeNode("catalogueName"))||void 0===n?void 0:n.nodeValue;if(o&&(s._name=o),a&&(s._catalog=a),!P(s,t)){const t=e.querySelectorAll("force>rules>rule");for(let e of t)if(e.hasAttribute("name")){let t=null===(i=e.getAttributeNode("name"))||void 0===i?void 0:i.nodeValue;const r=e.querySelector("rule>description");t&&r&&s._rules.set(t,r.textContent)}}D(e,s),t._forces.push(s)}}(e,n),n}}return null}function P(e,t){if(!t||!e)return!1;for(let r of t._forces)if(r._catalog===e._catalog)return!0;return!1}function D(e,t){let r=e.querySelectorAll("force>selections>selection");for(let e of r){let r=M(e);r&&r._role!=S.NONE&&t._units.push(r)}t._units.sort((e,t)=>e._role>t._role?1:e._role==t._role?0:-1)}function U(e){switch(e){case"HQ":return S.HQ;case"Troops":return S.TR;case"Elites":return S.EL;case"Fast Attack":return S.FA;case"Heavy Support":return S.HS;case"Flyer":return S.FL;case"Dedicated Transport":return S.DT;case"Fortification":return S.FT;case"Lord of War":return S.LW}return S.NONE}function M(e){var t,r,n,i,s,o,a,l,h,c,u,d,f,_,p,m,g,b,v;let y=new I,w=null===(t=e.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue;w&&(y._name=w);let C=e.querySelectorAll(":scope categories>category");for(let e of C){let t=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue;if(t){const e="Faction: ",r=t.lastIndexOf(e);if(r>=0){const n=t.slice(r+e.length);y._factions.add(n)}else{const e=U(t.trim());e!=S.NONE?y._role=e:y._keywords.add(t)}}}let x=null,k=null,L=null,O=null,B=e.querySelectorAll(":scope profiles>profile");for(let e of B){let t=null===(n=e.getAttributeNode("name"))||void 0===n?void 0:n.nodeValue,r=null===(i=e.getAttributeNode("typeName"))||void 0===i?void 0:i.nodeValue;if(t&&r)if("Unit"===r){x=new R,x._name=t;let r=e.querySelectorAll("characteristics>characteristic");for(let t of r){let r=null===(s=t.getAttributeNode("name"))||void 0===s?void 0:s.nodeValue;if(r&&t.textContent)switch(r){case"WS":x._ws=t.textContent;break;case"BS":x._bs=t.textContent;break;case"S":x._str=+t.textContent;break;case"T":x._toughness=+t.textContent;break;case"W":x._wounds=+t.textContent;break;case"I":x._initiative=+t.textContent;break;case"A":x._attacks=t.textContent;break;case"Ld":x._leadership=+t.textContent;break;case"Save":x._save=t.textContent}if(e.parentElement&&e.parentElement.parentElement){let t=null===(o=e.parentElement.parentElement.getAttributeNode("number"))||void 0===o?void 0:o.nodeValue;t&&(x._count=+t)}}y._models.push(x)}else if("Walker"===r){k=new z,k._name=t;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let t=null===(a=e.getAttributeNode("name"))||void 0===a?void 0:a.nodeValue;if(t&&e.textContent)switch(t){case"WS":k._ws=e.textContent;break;case"BS":k._bs=e.textContent;break;case"S":k._str=+e.textContent;break;case"Front":k._front=+e.textContent;break;case"Side":k._side=+e.textContent;break;case"Rear":k._rear=+e.textContent;break;case"I":k._initiative=+e.textContent;break;case"A":k._attacks=e.textContent;break;case"HP":k._hp=+e.textContent;break;case"Type":k._type=e.textContent}}y._walkers.push(k)}else if("Vehicle"===r){L=new Y,L._name=t;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let t=null===(l=e.getAttributeNode("name"))||void 0===l?void 0:l.nodeValue;if(t&&e.textContent)switch(t){case"BS":L._bs=e.textContent;break;case"Front":L._front=+e.textContent;break;case"Side":L._side=+e.textContent;break;case"Rear":L._rear=+e.textContent;break;case"HP":L._hp=+e.textContent;break;case"Type":L._type=e.textContent}}y._vehicles.push(L)}else if("Flyer"===r){O=new N,O._name=t;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let t=null===(h=e.getAttributeNode("name"))||void 0===h?void 0:h.nodeValue;if(t&&e.textContent)switch(t){case"BS":O._bs=e.textContent;break;case"Front":O._front=+e.textContent;break;case"Side":O._side=+e.textContent;break;case"Rear":O._rear=+e.textContent;break;case"HP":O._hp=+e.textContent;break;case"Combat Role":O._role=e.textContent;break;case"Pursuit":O._pursuit=e.textContent;break;case"Agility":O._agility=e.textContent}}y._flyers.push(O)}}for(let e of B){let t=null===(c=e.getAttributeNode("name"))||void 0===c?void 0:c.nodeValue,r=null===(u=e.getAttributeNode("typeName"))||void 0===u?void 0:u.nodeValue;if(t&&r){if("Wargear Item"===r){let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(d=e.getAttributeNode("name"))||void 0===d?void 0:d.nodeValue;r&&e.textContent&&t&&"Description"===r&&y._abilities.set(t,e.textContent)}}else if("Weapon"===r){let r=new A;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let t=null===(f=e.getAttributeNode("name"))||void 0===f?void 0:f.nodeValue;if(t&&e.textContent)switch(t){case"Range":r._range=e.textContent;break;case"Type":r._type=e.textContent;break;case"Strength":r._str=e.textContent;break;case"AP":r._ap=e.textContent}}x?x._weapons.push(r):k?k._weapons.push(r):L?L._weapons.push(r):O?O._weapons.push(r):console.log("Unexpected: Created a weapon without an active model.  Unit: "+w)}else if("Transport"==r){let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(_=e.getAttributeNode("name"))||void 0===_?void 0:_.nodeValue;r&&e.textContent&&t&&"Capacity"===r&&y._abilities.set(t,e.textContent)}}else if("Psychic Power"==r){let r=new T;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let t=null===(p=e.getAttributeNode("name"))||void 0===p?void 0:p.nodeValue;if(t&&e.textContent)switch(t){case"Warp Charge":r._warpCharge=+e.textContent;break;case"Power Category":r._category=e.textContent;break;case"Range":r._range=e.textContent;break;case"Details":r._details=e.textContent}}x?x._psychicPowers.push(r):console.log("Unexpected: Created a psychic power without an active model.  Unit: "+w)}else if("Psyker"==r){let r=new E;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let t=null===(m=e.getAttributeNode("name"))||void 0===m?void 0:m.nodeValue;if(t&&e.textContent)switch(t){case"Mastery Level":r._masteryLevel=e.textContent;break;case"Disciplines":r._disciplines=e.textContent}}x?x._psyker=r:console.log("Unexpected: Created a psyker without an active model.  Unit: "+w)}}else"Unit"===r||"Walker"===r||"Vehicle"===r||console.log("Unknown property type: "+r)}let W=e.querySelectorAll(":scope costs>cost");for(let e of W)if(e.hasAttribute("name")&&e.hasAttribute("value")){let t=null===(g=e.getAttributeNode("name"))||void 0===g?void 0:g.nodeValue,r=null===(b=e.getAttributeNode("value"))||void 0===b?void 0:b.nodeValue;r&&"pts"==t&&(y._points+=+r)}let P=e.querySelectorAll(":scope rules > rule");for(let e of P)if(e.hasAttribute("name")){let t=null===(v=e.getAttributeNode("name"))||void 0===v?void 0:v.nodeValue,r=e.querySelector("description");t&&r&&r.textContent&&y._rules.set(t,r.textContent)}return y}class F{constructor(e){this._descriptionStartX=190,this._descriptionWidth=600,this._showWoundBoxes=!0,this._roster=null,this._currentX=0,this._currentY=0,this._maxWidth=0,this._maxHeight=0,this._octagon=null,this._roles=new Map,this._unitLabelWidthsNormalized=[.3,.077,.077,.077,.077,.077,.077,.077,.077,.077],this._vehicleLabelWidthsNormalized=[.3,.1,.1,.1,.1,.1,.2],this._walkerLabelWidthsNormalized=[.3,.06,.06,.06,.06,.06,.06,.06,.06,.06,.15],this._flyerLabelWidthsNormalized=[.3,.077,.077,.077,.077,.077,.077,.077,.077,.077],this._weaponLabelWidthNormalized=[.3,.1,.1,.1,.4],this._spellLabelWidthNormalized=[.3,.1,.1,.5],this._roster=e,this._octagon=document.getElementById("octagon"),this._roles.set(S.HQ,document.getElementById("role_hq")),this._roles.set(S.TR,document.getElementById("role_tr")),this._roles.set(S.EL,document.getElementById("role_el")),this._roles.set(S.FA,document.getElementById("role_fa")),this._roles.set(S.HS,document.getElementById("role_hs")),this._roles.set(S.FL,document.getElementById("role_fl")),this._roles.set(S.DT,document.getElementById("role_dt")),this._roles.set(S.FT,document.getElementById("role_ft")),this._roles.set(S.LW,document.getElementById("role_lw"))}render(e,t,r){if(null!=this._roster){e&&(e.innerHTML="<h3>"+this._roster._name+" ("+this._roster._points+" pts)</h3>");for(let e of this._roster._forces){const n=document.createElement("div");n&&(n.innerHTML="<p>"+e._catalog+" "+e._name+"</p>"),t&&t.appendChild(n);const i=document.createElement("table");i.classList.add("table"),i.classList.add("table-sm"),i.classList.add("table-striped");const s=document.createElement("thead");i.appendChild(s),s.classList.add("thead-light");const o=document.createElement("tr");s.appendChild(o);[{name:"NAME",w:"25%"},{name:"ROLE",w:"20%"},{name:"MODELS",w:"40%"},{name:"POINTS",w:"15%"}].forEach(e=>{let t=document.createElement("th");t.scope="col",t.innerHTML=e.name,t.style.width=e.w,o.appendChild(t)}),n.appendChild(i);let a=document.createElement("tbody");i.appendChild(a);for(let t of e._units){let e=document.createElement("tr"),r=document.createElement("td");r.innerHTML=t._name;let n=document.createElement("td");n.innerHTML=L[t._role];let i=document.createElement("td");i.innerHTML="";let s=0;for(const e of t._models)e._count>1?i.innerHTML+=e._count+" "+e._name:i.innerHTML+=e._name,s++,s!=t._models.length&&(i.innerHTML+=",  ");let o=document.createElement("td");o.innerHTML=t._points.toString(),e.appendChild(r),e.appendChild(n),e.appendChild(i),e.appendChild(o),a.appendChild(e)}if(e._rules.size>0){let t=document.createElement("div"),n=document.createElement("h3");t.appendChild(n),n.textContent=e._catalog+" Allegiance Rules";for(let r of e._rules){let e=document.createElement("div"),n=document.createElement("h4");n.textContent=r[0];let i=document.createElement("p");i.textContent=r[1],e.appendChild(n),e.appendChild(i),t.appendChild(e)}r&&r.appendChild(t)}for(let t of e._units){let e=document.createElement("canvas");e.width=5.5*F._res,e.height=12*F._res,this._descriptionWidth=e.width-this._descriptionStartX-10;const n=this.renderUnit(t,e,0,0),i=25;let s=document.createElement("canvas");s.width=n[0]+2*i,s.height=n[1]+2*i;let o=s.getContext("2d");if(null==o||o.drawImage(e,i,i),r){let e=document.createElement("div");e.appendChild(s),r.appendChild(e)}}}}}renderBorder(e,t,r,n,i){e.strokeStyle=F._blackColor,e.beginPath(),e.moveTo(t,r+F._bevelSize),e.lineTo(t,r+i-F._bevelSize),e.lineTo(t+F._bevelSize,r+i),e.lineTo(t+n-F._bevelSize,r+i),e.lineTo(t+n,r+i-F._bevelSize),e.lineTo(t+n,r+F._bevelSize),e.lineTo(t+n-F._bevelSize,r),e.lineTo(t+F._bevelSize,r),e.closePath(),e.stroke(),e.save(),e.fillStyle=F._fillColor,e.globalCompositeOperation="destination-over",e.beginPath(),e.moveTo(t,r+F._bevelSize),e.lineTo(t,r+i-F._bevelSize),e.lineTo(t+F._bevelSize,r+i),e.lineTo(t+n-F._bevelSize,r+i),e.lineTo(t+n,r+i-F._bevelSize),e.lineTo(t+n,r+F._bevelSize),e.lineTo(t+n-F._bevelSize,r),e.lineTo(t+F._bevelSize,r),e.closePath(),e.fill(),e.restore()}renderWatermark(e){}renderLine(e){e.lineWidth=2,e.strokeStyle=F._blackColor,e.beginPath(),e.moveTo(this._currentX,this._currentY),e.lineTo(this._currentX+this._maxWidth,this._currentY),e.stroke(),this._currentY+=1}renderTableHeader(e,t,r){let n=this._currentX;const i=this._maxWidth;e.fillStyle=F._grey1,e.fillRect(this._currentX,this._currentY,i,22),e.fillStyle=F._blackColor,e.font="14px sans-serif";var s=50;if(t){e.font="12px sans-serif";for(let i=0;i<t.length;i++)r&&(s=r[i]),C(e,t[i],n,this._currentY,s,22,w.Center),n+=s}this._currentY+=22}renderPowers(e,t,r){e.font="12px sans-serif";let n=0,i=50;e.save();for(const s of t){let t=0,o=this._currentX,a=this._currentX,l=this._currentY;e.fillStyle=F._blackColor,r&&(i=r[t++]),C(e,s._name.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._warpCharge.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._range.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),this._currentY+=4,this._currentY=x(e,s._details,o,this._currentY,i),this._currentY+=2,o+=i,e.save(),e.fillStyle=n%2?F._greyLight:"#ffffff",e.globalCompositeOperation="destination-over";const h=this._currentY-l;e.fillRect(a,l,this._maxWidth,h),n++,e.restore()}e.restore()}renderWeapons(e,t,r){e.font="12px sans-serif";e.save();let n=0,i=50;for(const s of t){let t=0,o=this._currentX,a=this._currentX,l=this._currentY;e.fillStyle=F._blackColor,r&&(i=r[t++]),C(e,s._name.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._range.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._str.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._ap.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._type.toString(),o,this._currentY,i,22,w.Center),o+=i,this._currentY+=22,o+=i,e.save(),e.globalCompositeOperation="destination-over";const h=this._currentY-l;e.fillStyle=n%2?F._greyLight:"#ffffff",e.fillRect(a,l,this._maxWidth,h),n++,e.restore()}e.restore()}renderModel(e,t,r,n){let i=50,s=this._currentX,o=0;e.fillStyle=n%2?F._greyLight:"#ffffff",e.fillRect(s,this._currentY,this._maxWidth,24),e.fillStyle=F._blackColor,e.font="12px sans-serif",r&&(i=r[o++]),C(e,t._name.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._ws.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._bs.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._str.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._toughness.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._wounds.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._initiative.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._attacks.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._leadership.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._save.toString(),s,this._currentY,i,24,w.Center),s+=i,this._currentY+=24}renderVehicle(e,t,r,n){let i=50,s=this._currentX,o=0;e.fillStyle=n%2?F._greyLight:"#ffffff",e.fillRect(s,this._currentY,this._maxWidth,24),e.fillStyle=F._blackColor,e.font="12px sans-serif",r&&(i=r[o++]),C(e,t._name.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._bs.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._front.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._side.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._rear.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._hp.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._type.toString(),s,this._currentY,i,24,w.Center),s+=i,this._currentY+=24}renderWalker(e,t,r,n){let i=50,s=this._currentX,o=0;e.fillStyle=n%2?F._greyLight:"#ffffff",e.fillRect(s,this._currentY,this._maxWidth,24),e.fillStyle=F._blackColor,e.font="12px sans-serif",r&&(i=r[o++]),C(e,t._name.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._ws.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._bs.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._str.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._front.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._side.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._rear.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._initiative.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._attacks.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._hp.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._type.toString(),s,this._currentY,i,24,w.Center),s+=i,this._currentY+=24}renderFlyer(e,t,r,n){let i=50,s=this._currentX,o=0;e.fillStyle=n%2?F._greyLight:"#ffffff",e.fillRect(s,this._currentY,this._maxWidth,24),e.fillStyle=F._blackColor,e.font="12px sans-serif",r&&(i=r[o++]),C(e,t._name.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._bs.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._front.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._side.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._rear.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._hp.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._type.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._role.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._pursuit.toString(),s,this._currentY,i,24,w.Center),s+=i,r&&(i=r[o++]),C(e,t._agility.toString(),s,this._currentY,i,24,w.Center),s+=i,this._currentY+=24}renderAbilities(e,t){e.font="14px sans-serif",C(e,"ABILITIES",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";for(let r of t._abilities){const t=r[0].toUpperCase(),n=r[1];this._currentY+=2,this._currentY=x(e,t+": "+n,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2}}renderRules(e,t){e.font="14px sans-serif",C(e,"RULES",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";for(let r of t._rules){const t=r[0].toUpperCase(),n=r[1];this._currentY+=2,this._currentY=x(e,t+": "+n,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=4}}renderKeywords(e,t){e.font="14px sans-serif",C(e,"KEYWORDS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";const r=[...t._keywords].join(", ").toLocaleUpperCase();this._currentY+=2,this._currentY=x(e,r,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2}renderFactions(e,t){e.font="14px sans-serif",C(e,"FACTIONS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";const r=[...t._factions].join(", ").toLocaleUpperCase();this._currentY+=2,this._currentY=x(e,r,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2}renderModelList(e,t){e.font="14px sans-serif",C(e,"MODELS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";let r="",n=0;for(const e of t)e._count>1?r+=e._count+" "+e._name:r+=e._name,n++,n!=t.length&&(r+=",  ");this._currentY+=2,this._currentY=x(e,r,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2}renderWoundBoxes(e,t){e.font="14px sans-serif",C(e,"WOUNDS",this._currentX+20,this._currentY,100,16,w.Left);const r=this._currentX+this._descriptionStartX,n=r+195;e.save();for(let i of t)if(i._wounds>1){let t=this._currentY;e.font="12px serif",e.fillStyle=F._blackColor,this._currentY=x(e,i._name,r,this._currentY+3,195);let s=this._currentX+n;e.strokeStyle=F._blackColor,e.fillStyle="#ffffff";for(let r=0;r<i._wounds;r++)r%15==0&&0!=r&&(t+=25,s=this._currentX+n),e.fillRect(s,t,20,20),e.strokeRect(s,t,20,20),s+=25;t+=25,this._currentY=Math.max(this._currentY,t)}e.restore()}renderUnit(e,t,r,n){let i=t.getContext("2d");if(!i)return[0,0];this._currentX=r+F._margin,this._currentY=n+F._margin,this._maxWidth=t.width-this._currentX,this._maxHeight=Math.max(0,t.height-this._currentY),this.renderHeader(e,i),i.fillStyle=F._blackColor;let s=[],o=[],a=[],l=[];const h=[];this._unitLabelWidthsNormalized.forEach(e=>{h.push(e*this._maxWidth)});const c=[];this._vehicleLabelWidthsNormalized.forEach(e=>{c.push(e*this._maxWidth)});const u=[];this._walkerLabelWidthsNormalized.forEach(e=>{u.push(e*this._maxWidth)});const d=[];for(var f of(this._flyerLabelWidthsNormalized.forEach(e=>{d.push(e*this._maxWidth)}),e._models)){l.push(f);for(let e of f._weapons)s.push(e);for(let e of f._psychicPowers)o.push(e);f._psyker&&a.push(f._psyker)}const _=[],p=new Map;for(const e of l)p.has(e._name)||(p.set(e._name,e),_.push(e));if(_.length>0){this.renderTableHeader(i,F._unitLabels,h);let e=0;for(var f of _)this.renderModel(i,f,h,e%2),e++}if(e._vehicles.length>0){this.renderTableHeader(i,F._vehicleLabels,c);let t=0;for(var m of e._vehicles)this.renderVehicle(i,m,c,t%2),t++}if(e._walkers.length>0){this.renderTableHeader(i,F._walkerLabels,u);let t=0;for(var g of e._walkers)this.renderWalker(i,g,u,t%2),t++}if(e._flyers.length>0){this.renderTableHeader(i,F._flyerLabels,d);let t=0;for(var b of e._flyers)this.renderFlyer(i,b,d,t%2),t++}const v=[],y=new Map;for(const e of s)y.has(e._name)||(y.set(e._name,e),v.push(e));if(v.length>0){const e=[];this._weaponLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,F._weaponLabels,e),this.renderWeapons(i,v,e)}if(o.length>0){const e=[];this._spellLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,F._spellLabels,e),this.renderPowers(i,o,e)}if(e._abilities.size>0&&(this.renderLine(i),this._currentY+=2,this.renderAbilities(i,e)),a.length>0&&(this.renderLine(i),this._currentY+=2,this.renderPsykers(i,a)),e._rules.size>0&&(this.renderLine(i),this._currentY+=2,this.renderRules(i,e)),e._factions.size>0&&(this.renderLine(i),this._currentY+=2,this.renderFactions(i,e)),e._keywords.size>0&&(this.renderLine(i),this._currentY+=2,this.renderKeywords(i,e)),e._models.length>0&&(this.renderLine(i),this._currentY+=2,this.renderModelList(i,_)),this._showWoundBoxes){let t=!1;for(let r of e._models)r._wounds>2&&(t=!0);t&&(this.renderLine(i),this._currentY+=5,this.renderWoundBoxes(i,e._models))}this._currentY+=2;const w=this._currentY-(n+F._margin),S=this._maxWidth;return this.renderBorder(i,this._currentX,n+F._margin,S,w),this.renderWatermark(i),[this._maxWidth,this._currentY]}renderHeader(e,t){t.globalAlpha=1,t.fillStyle=F._blackColor;const r=this._currentX,n=this._currentX+this._maxWidth,i=this._currentY,s=i+36;t.beginPath(),t.moveTo(r,i+F._bevelSize),t.lineTo(r,s),t.lineTo(n,s),t.lineTo(n,i+F._bevelSize),t.lineTo(n-F._bevelSize,i),t.lineTo(r+F._bevelSize,i),t.closePath(),t.fill();let o=r+6;if(this._octagon){t.drawImage(this._octagon,o,i+2,32,32);const r=this._roles.get(e._role);r&&t.drawImage(r,o+4,i+2+4,24,24),t.fillStyle="white",t.font="18px serif",o+=34,t.drawImage(this._octagon,o,i+2,32,32),C(t,e._points.toString(),o,i+2,32,32,w.Center)}let a=0,l=28;const h=o+6;t.font=l+"px bold serif";const c=e._name.toLocaleUpperCase();let u=t.measureText(c);const d=this._maxWidth-h;for(;a<6&&u.width>d;)a+=1,l-=2,t.font=l+"px bold serif",u=t.measureText(c);t.fillStyle="white",t.textBaseline="top",C(t,c,h,i,d,36,w.Center),this._currentY+=36}renderPsykers(e,t){e.font="14px sans-serif",C(e,"PSYKERS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif",this._currentY+=2;for(let r of t)this._currentY=x(e,"MASTERY LEVEL: "+r._masteryLevel,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2,this._currentY=x(e,"DISCIPLINES: "+r._disciplines,this._currentX+this._descriptionStartX,this._currentY,this._descriptionWidth),this._currentY+=2}}F._res=144,F._margin=0,F._bevelSize=15,F._blackColor="#1d272a",F._grey1="#b3bbb5",F._greyLight="#dde1df",F._fillColor="#f6f6f6",F._unitLabels=["MODEL","WS","BS","S","T","W","I","A","LD","SAVE"],F._vehicleLabels=["MODEL","BS","FRONT","SIDE","REAR","HP","TYPE"],F._walkerLabels=["MODEL","WS","BS","S","FRONT","SIDE","REAR","I","A","HP","TYPE"],F._flyerLabels=["MODEL","BS","FRONT","SIDE","REAR","HP","TYPE","ROLE","PURSUIT","AGILITY"],F._weaponLabels=["WEAPONS","RANGE","S","AP","TYPE"],F._spellLabels=["PSYCHIC POWER","WARP CHARGE","RANGE","DETAILS"];class H{constructor(){this._name="",this._type="Melee",this._range="",this._attacks="",this._toHit="",this._toWound="",this._rend="",this._damage=""}}class X{constructor(){this._name="",this._castingValue=0,this._description=""}}class V{constructor(){this._name="",this._description=""}}class j{constructor(){this._name="",this._battleTraits=new Map,this._commandAbilities=new Map}}var q;!function(e){e[e.NONE=0]="NONE",e[e.LEADER=1]="LEADER",e[e.BATTLELINE=2]="BATTLELINE",e[e.BEHEMOTH=3]="BEHEMOTH",e[e.ARTILLERY=4]="ARTILLERY",e[e.OTHER=5]="OTHER",e[e.SCENERY=6]="SCENERY",e[e.BATTALION=7]="BATTALION",e[e.MALIGN_SORCERY=8]="MALIGN_SORCERY",e[e.REALM=9]="REALM"}(q||(q={}));const Z=["None","Leader","Battleline","Behemoth","Artillery","Other","Scenery","Battalion","Malign Sorcery","Realm"];class G{constructor(){this._name="",this._role=q.NONE,this._keywords=new Set,this._abilities=new Map,this._commandAbilities=new Map,this._commandTraits=new Map,this._magic=new Map,this._artefacts=new Map,this._count=0,this._move='0"',this._wounds=1,this._bravery=7,this._save="",this._weapons=[],this._spells=[],this._prayers=[],this._points=0,this._woundTracker=null}}class K{constructor(){this._catalog="",this._name="Unknown",this._units=[],this._allegiance=new j}}class Q{constructor(){this._commandPoints=0,this._points=0,this._name="",this._forces=[]}}function J(e){switch(e){case"Leader":return q.LEADER;case"Battleline":return q.BATTLELINE;case"Other":return q.OTHER;case"Behemoth":return q.BEHEMOTH;case"Artillery":return q.ARTILLERY;case"Scenery":return q.SCENERY;case"Battalion":return q.BATTALION;case"Malign Sorcery":return q.MALIGN_SORCERY;case"Realm":return q.REALM}return q.NONE}function ee(e){var t;if(e){let r=e.querySelector("roster");if(r){const n=new Q,i=null===(t=r.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue;return n._name=i||"Age of Sigmar Roster",function(e,t){var r,n;let i=e.querySelectorAll("roster>costs>cost");for(let e of i)if(e.hasAttribute("name")&&e.hasAttribute("value")){let i=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,s=null===(n=e.getAttributeNode("value"))||void 0===n?void 0:n.nodeValue;s&&"pts"===i&&(t._points=+s)}}(e,n),function(e,t){var r,n;let i=e.querySelectorAll("roster>forces>force");for(let e of i)if(e.hasAttribute("name")&&e.hasAttribute("catalogueName")){let i=new K,s=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,o=null===(n=e.getAttributeNode("catalogueName"))||void 0===n?void 0:n.nodeValue;s&&(i._name=s),o&&(i._catalog=o),te(e,i),t._forces.push(i)}}(e,n),n}}return null}function te(e,t){var r,n;let i=e.querySelectorAll("force>selections>selection");for(let e of i){if(!(null===(r=e.getAttributeNode("type"))||void 0===r?void 0:r.nodeValue))continue;let i=null===(n=e.getAttributeNode("name"))||void 0===n?void 0:n.nodeValue;if(i&&i.includes("Allegiance")){let r=ne(e);r&&(t._allegiance=r)}else{let r=re(e);r&&r._role!=q.NONE&&t._units.push(r)}}t._units.sort((e,t)=>e._role>t._role?1:e._role==t._role?0:-1)}function re(e){var t,r,n,i,s,o,a,l,h,c,u;let d=new G,f=e.querySelectorAll("profiles>profile");for(let e of f){let l=null===(t=e.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue,h=null===(r=e.getAttributeNode("typeName"))||void 0===r?void 0:r.nodeValue;if(l&&h)if("Unit"==h){d._name=l;let t=e.querySelectorAll("characteristics>characteristic");for(let e of t){let t=null===(n=e.getAttributeNode("name"))||void 0===n?void 0:n.nodeValue;if(t&&e.textContent)switch(t){case"Move":d._move=e.textContent;break;case"Wounds":d._wounds=+e.textContent;break;case"Bravery":d._bravery=+e.textContent;break;case"Save":d._save=e.textContent}}}else if("Unit Abilities"==h){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._abilities.set(l,t.textContent)}else if("Command Abilities"==h){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._commandAbilities.set(l,t.textContent)}else if("Magic"==h){let t=e.querySelectorAll("characteristics>characteristic");for(let e of t){let t=null===(i=e.getAttributeNode("name"))||void 0===i?void 0:i.nodeValue;t&&e.textContent&&d._magic.set(t,e.textContent)}}else if("Unit Leader"==h){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._abilities.set(h,t.textContent)}else if("Spell"==h){let t=new X;t._name=l;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(s=e.getAttributeNode("name"))||void 0===s?void 0:s.nodeValue;if(r&&e.textContent)switch(r){case"Casting Value":t._castingValue=+e.textContent;break;case"Description":t._description=e.textContent}}d._spells.push(t)}else if("Weapon"==h){let t=new H;t._name=l;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(o=e.getAttributeNode("name"))||void 0===o?void 0:o.nodeValue;if(r&&e.textContent)switch(r){case"Range":t._range=e.textContent;break;case"Type":t._type=e.textContent;break;case"Attacks":t._attacks=e.textContent;break;case"Rend":t._rend=e.textContent;break;case"To Hit":t._toHit=e.textContent;break;case"To Wound":t._toWound=e.textContent;break;case"Damage":t._damage=e.textContent}}d._weapons.push(t)}else if("Command Trait"==h){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._commandTraits.set(l,t.textContent)}else if("Artefact"==h){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._artefacts.set(l,t.textContent)}else if("Prayer"==h){let t=new V;t._name=l;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(a=e.getAttributeNode("name"))||void 0===a?void 0:a.nodeValue;if(r&&e.textContent)switch(r){case"Description":t._description=e.textContent}}d._prayers.push(t)}else h.includes("Wound Track")||h.includes("Damage Table")||h.includes("Wounds")||console.log("Unknown unit profile type: "+h)}let _=e.querySelectorAll("costs>cost");for(let e of _)if(e.hasAttribute("name")&&e.hasAttribute("value")){let t=null===(l=e.getAttributeNode("name"))||void 0===l?void 0:l.nodeValue,r=null===(h=e.getAttributeNode("value"))||void 0===h?void 0:h.nodeValue;r&&"pts"===t&&(d._points+=+r)}let p=e.querySelectorAll(":scope categories>category");for(let e of p){let t=null===(c=e.getAttributeNode("name"))||void 0===c?void 0:c.nodeValue;null===(u=e.getAttributeNode("primary"))||void 0===u||u.nodeValue;if(t){var m=J(t.trim());m!=q.NONE?d._role=m:d._keywords.add(t)}}return d}function ne(e){var t,r,n;let i=null,s=e.querySelector("selections>selection");if(s){let e=null===(t=s.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue;e&&(i=new j,i._name=e);let o=s.querySelectorAll("profiles>profile");for(let e of o){let t=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,s=null===(n=e.getAttributeNode("typeName"))||void 0===n?void 0:n.nodeValue;if(t&&s)if("Battle Trait"==s){let r=e.querySelector("characteristics>characteristic");if(r){let e=r.textContent;e&&(null==i||i._battleTraits.set(t,e))}}else if("Command Abilities"==s){let r=e.querySelector("characteristics>characteristic");if(r){let e=r.textContent;e&&(null==i||i._commandAbilities.set(t,e))}}else console.log("Unexpected allegiance profile type: "+s)}}return i}class ie{constructor(e){this._statsWheel=null,this._roster=null,this._currentX=0,this._currentY=0,this._maxWidth=0,this._maxHeight=0,this._unitLabelWidthsNormalized=[.4,.15,.15,.15,.15],this._weaponLabelWidthNormalized=[.4,.1,.1,.1,.1,.1,.1],this._spellLabelWidthNormalized=[.3,.2,.5],this._prayerLabelWidthNormalized=[.4,.6],this._trackerLabelWidth=[.3,.2,.15,.15,.15],this._roster=e,this._statsWheel=document.getElementById("aos_stats")}render(e,t,r){if(null!=this._roster){e&&(e.innerHTML="<h3>"+this._roster._name+" ("+this._roster._points+" pts, "+this._roster._commandPoints+" CP)</h3>");for(let e of this._roster._forces){const n=document.createElement("div");n&&(n.innerHTML="<p>"+e._catalog+" "+e._name+"</p>"),t&&t.appendChild(n);const i=document.createElement("table");i.classList.add("table"),i.classList.add("table-sm"),i.classList.add("table-striped");const s=document.createElement("thead");i.appendChild(s),s.classList.add("thead-light");const o=document.createElement("tr");s.appendChild(o);[{name:"NAME",w:"35%"},{name:"ROLE",w:"25%"},{name:"MODELS",w:"25%"},{name:"POINTS",w:"15%"}].forEach(e=>{let t=document.createElement("th");t.scope="col",t.innerHTML=e.name,t.style.width=e.w,o.appendChild(t)}),n.appendChild(i);let a=document.createElement("tbody");i.appendChild(a);for(let t of e._units){let e=document.createElement("tr"),r=document.createElement("td");r.innerHTML=t._name;let n=document.createElement("td");n.innerHTML=Z[t._role];let i=document.createElement("td");i.innerHTML="";let s=document.createElement("td");s.innerHTML=t._points.toString(),e.appendChild(r),e.appendChild(n),e.appendChild(i),e.appendChild(s),a.appendChild(e)}let l=document.createElement("div");if(e._allegiance._commandAbilities.size>0){let t=document.createElement("h3");l.appendChild(t),t.textContent=e._allegiance._name+" Allegiance Abilities";for(let t of e._allegiance._commandAbilities){let e=document.createElement("div"),r=document.createElement("h4");r.textContent=t[0];let n=document.createElement("p");n.textContent=t[1],e.appendChild(r),e.appendChild(n),l.appendChild(e)}}if(e._allegiance._battleTraits.size>0){let t=document.createElement("h3");l.appendChild(t),t.textContent=e._allegiance._name+" Allegiance Battle Traits";for(let t of e._allegiance._battleTraits){let e=document.createElement("div"),r=document.createElement("h4");r.textContent=t[0];let n=document.createElement("p");n.textContent=t[1],e.appendChild(r),e.appendChild(n),l.appendChild(e)}}r&&r.appendChild(l);for(let t of e._units){let e=document.createElement("canvas");e.width=5.5*ie._res,e.height=8.5*ie._res;const n=this.renderUnit(t,e,0,0),i=25;let s=document.createElement("canvas");s.width=n[0]+2*i,s.height=n[1]+2*i;let o=s.getContext("2d");null==o||o.drawImage(e,i,i),r&&r.appendChild(s)}}}}renderUnit(e,t,r,n){let i=t.getContext("2d");if(!i)return[0,0];this._currentX=r+ie._margin,this._currentY=n+ie._margin,this._maxWidth=t.width-this._currentX,this._maxHeight=Math.max(0,t.height-this._currentY),this.renderHeader(e,i);const s=[];this._unitLabelWidthsNormalized.forEach(e=>{s.push(e*this._maxWidth)}),this.renderTableHeader(i,ie._unitLabels,s),this.renderUnitStats(i,e,s,0);const o=[],a=new Map;for(const t of e._weapons)a.has(t._name)||(a.set(t._name,t),o.push(t));let l=[],h=[];for(let e of o)"Melee"==e._type?h.push(e):l.push(e);if(l.length){const e=[];this._weaponLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,ie._weaponLabels,e),this.renderWeapons(i,l,e)}if(h.length){const e=[];this._weaponLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,ie._meleeLabels,e),this.renderWeapons(i,h,e)}if(e._spells.length>0){const t=[];this._spellLabelWidthNormalized.forEach(e=>{t.push(e*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,ie._spellLabels,t),this.renderSpells(i,e._spells,t)}if(e._prayers.length>0){const t=[];this._prayerLabelWidthNormalized.forEach(e=>{t.push(e*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,ie._prayerLabels,t),this.renderPrayers(i,e._prayers,t)}if(e._abilities.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"ABILITIES",e._abilities)),e._commandAbilities.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"COMMAND ABILITIES",e._commandAbilities)),e._commandTraits.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"COMMAND TRAITS",e._commandTraits)),e._artefacts.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"ARTEFACTS",e._artefacts)),e._magic.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"MAGIC",e._magic)),e._woundTracker){this.renderLine(i);const t=[];this._trackerLabelWidth.forEach(e=>{t.push(e*this._maxWidth)}),this.renderTableHeader(i,e._woundTracker._woundTrackerLabels,t),this.renderWoundTable(i,e,t)}e._keywords.size>0&&(this.renderLine(i),this._currentY+=2,this.renderKeywords(i,e));const c=this._currentY-(n+ie._margin),u=this._maxWidth;return this.renderBorder(i,this._currentX,n+ie._margin,u,c),[this._maxWidth,this._currentY]}renderHeader(e,t){t.globalAlpha=1,t.fillStyle=ie._blackColor;const r=this._currentX,n=this._currentX+this._maxWidth,i=this._currentY,s=i+36;t.beginPath(),t.moveTo(r,i+ie._bevelSize),t.lineTo(r,s),t.lineTo(n,s),t.lineTo(n,i+ie._bevelSize),t.lineTo(n-ie._bevelSize,i),t.lineTo(r+ie._bevelSize,i),t.closePath(),t.fill();let o=0,a=28;const l=r+6+6;t.font=a+"px bold serif";const h=e._name.toLocaleUpperCase();let c=t.measureText(h);const u=this._maxWidth-l;for(;o<6&&c.width>u;)o+=1,a-=2,t.font=a+"px bold serif",c=t.measureText(h);t.fillStyle="white",t.textBaseline="top",C(t,h,l,i,u,36,w.Center),this._currentY+=36}renderTableHeader(e,t,r){let n=this._currentX;const i=this._maxWidth;e.fillStyle=ie._grey1,e.fillRect(this._currentX,this._currentY,i,22),e.fillStyle=ie._blackColor,e.font="14px sans-serif";var s=50;if(t){e.font="12px sans-serif";for(let i=0;i<t.length;i++)r&&(s=r[i]),C(e,t[i],n,this._currentY,s,22,w.Center),n+=s}this._currentY+=22}renderKeywords(e,t){e.font="14px sans-serif",C(e,"KEYWORDS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";const r=[...t._keywords].join(", ").toLocaleUpperCase();this._currentY=x(e,r,this._currentX+190,this._currentY,500),this._currentY+=4}renderLine(e){e.lineWidth=2,e.strokeStyle=ie._blackColor,e.beginPath(),e.moveTo(this._currentX,this._currentY),e.lineTo(this._currentX+this._maxWidth,this._currentY),e.stroke(),this._currentY+=1}renderWeapons(e,t,r){e.font="12px sans-serif";e.save();let n=0,i=50;for(const s of t){let t=0,o=this._currentX,a=this._currentX,l=this._currentY;e.fillStyle=ie._blackColor,r&&(i=r[t++]),C(e,s._name.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._range.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._attacks.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._toHit.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._toWound.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._rend.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._damage.toString(),o,this._currentY,i,22,w.Center),o+=i,this._currentY+=22,e.save(),e.globalCompositeOperation="destination-over";const h=this._currentY-l;e.fillStyle=n%2?ie._greyLight:"#ffffff",e.fillRect(a,l,this._maxWidth,h),n++,e.restore()}e.restore()}renderMap(e,t,r){e.font="14px sans-serif",C(e,t,this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";for(let t of r){const r=t[0].toUpperCase(),n=t[1];this._currentY+=2,this._currentY=x(e,r+": "+n,this._currentX+190,this._currentY,500)}this._currentY+=4}renderSpells(e,t,r){e.font="12px sans-serif";let n=0,i=50;e.save();for(const s of t){let t=0,o=this._currentX,a=this._currentX,l=this._currentY;e.fillStyle=ie._blackColor,r&&(i=r[t++]),C(e,s._name.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._castingValue.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),this._currentY+=2,this._currentY=x(e,s._description,o,this._currentY,i),o+=i,e.save(),e.fillStyle=n%2?ie._greyLight:"#ffffff",e.globalCompositeOperation="destination-over";const h=this._currentY-l;e.fillRect(a,l,this._maxWidth,h),n++,e.restore()}e.restore()}renderPrayers(e,t,r){e.font="12px sans-serif";let n=0,i=50;e.save();for(const s of t){let t=0,o=this._currentX,a=this._currentX,l=this._currentY;e.fillStyle=ie._blackColor,r&&(i=r[t++]),C(e,s._name.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),this._currentY+=2,this._currentY=x(e,s._description,o,this._currentY,i),o+=i,e.save(),e.fillStyle=n%2?ie._greyLight:"#ffffff",e.globalCompositeOperation="destination-over";const h=this._currentY-l;e.fillRect(a,l,this._maxWidth,h),n++,e.restore()}e.restore()}renderUnitStats(e,t,r,n){let i=50,s=this._currentX,o=0;e.fillStyle=n%2?ie._greyLight:"#ffffff",e.fillRect(s,this._currentY,this._maxWidth,22),e.fillStyle=ie._blackColor,e.font="12px sans-serif",r&&(i=r[o++]),C(e,t._name.toString(),s,this._currentY,i,22,w.Center),s+=i,r&&(i=r[o++]),C(e,t._move.toString(),s,this._currentY,i,22,w.Center),s+=i,r&&(i=r[o++]),C(e,t._wounds.toString(),s,this._currentY,i,22,w.Center),s+=i,r&&(i=r[o++]),C(e,t._bravery.toString(),s,this._currentY,i,22,w.Center),s+=i,r&&(i=r[o++]),C(e,t._save.toString(),s,this._currentY,i,22,w.Center),s+=i,this._currentY+=22}renderWoundTable(e,t,r){if(null==t._woundTracker)return;let n=50,i=this._currentX,s=0;e.fillStyle=ie._greyLight,e.fillRect(i,this._currentY,this._maxWidth,22),e.fillStyle=ie._blackColor,e.font="12px sans-serif",r&&(n=r[s++]),C(e,t._woundTracker._name,i,this._currentY,n,22,w.Center),i+=n;for(let o of t._woundTracker._table)r&&(n=r[s++]),C(e,o[1],i,this._currentY,n,22,w.Center),i+=n;this._currentY+=22}renderBorder(e,t,r,n,i){e.strokeStyle=ie._blackColor,e.beginPath(),e.moveTo(t,r+ie._bevelSize),e.lineTo(t,r+i-ie._bevelSize),e.lineTo(t+ie._bevelSize,r+i),e.lineTo(t+n-ie._bevelSize,r+i),e.lineTo(t+n,r+i-ie._bevelSize),e.lineTo(t+n,r+ie._bevelSize),e.lineTo(t+n-ie._bevelSize,r),e.lineTo(t+ie._bevelSize,r),e.closePath(),e.stroke(),e.save(),e.fillStyle=ie._fillColor,e.globalCompositeOperation="destination-over",e.beginPath(),e.moveTo(t,r+ie._bevelSize),e.lineTo(t,r+i-ie._bevelSize),e.lineTo(t+ie._bevelSize,r+i),e.lineTo(t+n-ie._bevelSize,r+i),e.lineTo(t+n,r+i-ie._bevelSize),e.lineTo(t+n,r+ie._bevelSize),e.lineTo(t+n-ie._bevelSize,r),e.lineTo(t+ie._bevelSize,r),e.closePath(),e.fill(),e.restore()}}ie._res=144,ie._margin=0,ie._bevelSize=15,ie._blackColor="#1d272a",ie._grey1="#b3bbb5",ie._greyLight="#dde1df",ie._fillColor="#f6f6f6",ie._unitLabels=["UNIT","MOVE","WOUNDS","BRAVERY","SAVE"],ie._weaponLabels=["MISSILE WEAPONS","RANGE","ATTACKS","TO HIT","TO WOUND","REND","DAMAGE"],ie._meleeLabels=["MELEE WEAPONS","RANGE","ATTACKS","TO HIT","TO WOUND","REND","DAMAGE"],ie._spellLabels=["SPELL","CASTING VALUE","DESCRIPTION"],ie._prayerLabels=["PRAYER","DESCRIPTION"];class se{constructor(){this._name="",this._rules=new Map}}class oe{constructor(){this._name="",this._range="",this._attacks="",this._strength="",this._damage=""}}var ae;!function(e){e[e.NONE=0]="NONE",e[e.LEADER=1]="LEADER",e[e.FIGHTER=2]="FIGHTER",e[e.ALLY=3]="ALLY"}(ae||(ae={}));const le=["None","Leader","Fighter","Ally"];class he{constructor(){this._name="",this._role=ae.NONE,this._keywords=new Set,this._abilities=new Map,this._move=1,this._wounds=1,this._toughness=1,this._weapons=[],this._points=0}}class ce{constructor(){this._catalog="",this._name="Unknown",this._units=[],this._allegiance=new se}}class ue{constructor(){this._points=0,this._name="",this._forces=[]}}function de(e){switch(e){case"Leader":return ae.LEADER;case"Fighter":return ae.FIGHTER;case"Ally":return ae.ALLY}return ae.NONE}function fe(e){var t;if(e){let r=e.querySelector("roster");if(r){const n=new ue,i=null===(t=r.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue;return n._name=i||"Age of Sigmar Warcry Roster",function(e,t){var r,n;let i=e.querySelectorAll("roster>costs>cost");for(let e of i)if(e.hasAttribute("name")&&e.hasAttribute("value")){let i=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,s=null===(n=e.getAttributeNode("value"))||void 0===n?void 0:n.nodeValue;s&&"pts"===i&&(t._points=+s)}}(e,n),function(e,t){var r,n;let i=e.querySelectorAll("roster>forces>force");for(let e of i)if(e.hasAttribute("name")&&e.hasAttribute("catalogueName")){let i=new ce,s=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,o=null===(n=e.getAttributeNode("catalogueName"))||void 0===n?void 0:n.nodeValue;s&&(i._name=s),o&&(i._catalog=o),_e(e,i),pe(e,i),t._forces.push(i)}console.log(t)}(e,n),n}}return null}function _e(e,t){var r;let n=new se,i=e.querySelectorAll("rules>rule");for(let e of i)if(e.hasAttribute("name")){let t=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue;var s=e.querySelector("rule>description");t&&s&&s.textContent&&n._rules.set(t,s.textContent)}t._allegiance=n}function pe(e,t){var r,n;let i=e.querySelectorAll("force>selections>selection");for(let e of i){if(!(null===(r=e.getAttributeNode("type"))||void 0===r?void 0:r.nodeValue))continue;null===(n=e.getAttributeNode("name"))||void 0===n||n.nodeValue;let i=me(e);i&&i._role!=ae.NONE&&t._units.push(i)}t._units.sort((e,t)=>e._role>t._role?1:e._role==t._role?0:-1)}function me(e){var t,r,n,i,s,o,a,l;let h=new he,c=e.querySelectorAll("profiles>profile");for(let e of c){let s=null===(t=e.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue,o=null===(r=e.getAttributeNode("typeName"))||void 0===r?void 0:r.nodeValue;if(s&&o)if("Model"==o){h._name=s;let t=e.querySelectorAll("characteristics>characteristic");for(let e of t){let t=null===(n=e.getAttributeNode("name"))||void 0===n?void 0:n.nodeValue;if(t&&e.textContent)switch(t){case"Move":h._move=+e.textContent;break;case"Wounds":h._wounds=+e.textContent;break;case"Toughness":h._toughness=+e.textContent}}}else if("Weapon"==o){let t=new oe;t._name=s;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(i=e.getAttributeNode("name"))||void 0===i?void 0:i.nodeValue;if(r&&e.textContent)switch(r){case"Range":t._range=e.textContent;break;case"Attacks":t._attacks=e.textContent;break;case"Strength":t._strength=e.textContent;break;case"Damage":t._damage=e.textContent}}h._weapons.push(t)}else console.log("Unknown unit profile type: "+o)}let u=e.querySelectorAll("costs>cost");for(let e of u)if(e.hasAttribute("name")&&e.hasAttribute("value")){let t=null===(s=e.getAttributeNode("name"))||void 0===s?void 0:s.nodeValue,r=null===(o=e.getAttributeNode("value"))||void 0===o?void 0:o.nodeValue;r&&"pts"===t&&(h._points+=+r)}let d=e.querySelectorAll(":scope categories>category");for(let e of d){let t=null===(a=e.getAttributeNode("name"))||void 0===a?void 0:a.nodeValue;null===(l=e.getAttributeNode("primary"))||void 0===l||l.nodeValue;if(t){var f=de(t.trim());f!=ae.NONE?h._role=f:h._keywords.add(t)}}return h}class ge{constructor(e){this._roster=null,this._currentX=0,this._currentY=0,this._maxWidth=0,this._maxHeight=0,this._unitLabelWidthsNormalized=[.4,.2,.2,.2],this._weaponLabelWidthNormalized=[.4,.15,.15,.15,.15],this._roster=e}render(e,t,r){if(null!=this._roster){e&&(e.innerHTML="<h3>"+this._roster._name+" ("+this._roster._points+" pts</h3>");for(let e of this._roster._forces){const n=document.createElement("div");n&&(n.innerHTML="<p>"+e._catalog+" "+e._name+"</p>"),t&&t.appendChild(n);const i=document.createElement("table");i.classList.add("table"),i.classList.add("table-sm"),i.classList.add("table-striped");const s=document.createElement("thead");i.appendChild(s),s.classList.add("thead-light");const o=document.createElement("tr");s.appendChild(o);[{name:"NAME",w:"35%"},{name:"ROLE",w:"25%"},{name:"POINTS",w:"15%"}].forEach(e=>{let t=document.createElement("th");t.scope="col",t.innerHTML=e.name,t.style.width=e.w,o.appendChild(t)}),n.appendChild(i);let a=document.createElement("tbody");i.appendChild(a);for(let t of e._units){let e=document.createElement("tr"),r=document.createElement("td");r.innerHTML=t._name;let n=document.createElement("td");n.innerHTML=le[t._role];let i=document.createElement("td");i.innerHTML=t._points.toString(),e.appendChild(r),e.appendChild(n),e.appendChild(i),a.appendChild(e)}let l=document.createElement("div");if(e._allegiance._rules.size>0){let t=document.createElement("h3");l.appendChild(t),t.textContent=e._allegiance._name+" Abilities";for(let t of e._allegiance._rules){let e=document.createElement("div"),r=document.createElement("h4");r.textContent=t[0];let n=document.createElement("p");n.textContent=t[1],e.appendChild(r),e.appendChild(n),l.appendChild(e)}}r&&r.appendChild(l);for(let t of e._units){let e=document.createElement("canvas");e.width=5.5*ge._res,e.height=8.5*ge._res;const n=this.renderUnit(t,e,0,0),i=25;let s=document.createElement("canvas");s.width=n[0]+2*i,s.height=n[1]+2*i;let o=s.getContext("2d");null==o||o.drawImage(e,i,i),r&&r.appendChild(s)}}}}renderUnit(e,t,r,n){let i=t.getContext("2d");if(!i)return[0,0];this._currentX=r+ge._margin,this._currentY=n+ge._margin,this._maxWidth=t.width-this._currentX,this._maxHeight=Math.max(0,t.height-this._currentY),this.renderHeader(e,i);const s=[];this._unitLabelWidthsNormalized.forEach(e=>{s.push(e*this._maxWidth)}),this.renderTableHeader(i,ge._unitLabels,s),this.renderUnitStats(i,e,s,0);const o=[];this._weaponLabelWidthNormalized.forEach(e=>{o.push(e*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,ge._weaponLabels,o),this.renderWeapons(i,e._weapons,o),e._keywords.size>0&&(this.renderLine(i),this._currentY+=2,this.renderKeywords(i,e));const a=this._currentY-(n+ge._margin),l=this._maxWidth;return this.renderBorder(i,this._currentX,n+ge._margin,l,a),[this._maxWidth,this._currentY]}renderHeader(e,t){t.globalAlpha=1,t.fillStyle=ge._blackColor;const r=this._currentX,n=this._currentX+this._maxWidth,i=this._currentY,s=i+36;t.beginPath(),t.moveTo(r,i+ge._bevelSize),t.lineTo(r,s),t.lineTo(n,s),t.lineTo(n,i+ge._bevelSize),t.lineTo(n-ge._bevelSize,i),t.lineTo(r+ge._bevelSize,i),t.closePath(),t.fill();let o=0,a=28;const l=r+6+6;t.font=a+"px bold serif";const h=e._name.toLocaleUpperCase();let c=t.measureText(h);const u=this._maxWidth-l;for(;o<6&&c.width>u;)o+=1,a-=2,t.font=a+"px bold serif",c=t.measureText(h);t.fillStyle="white",t.textBaseline="top",C(t,h,l,i,u,36,w.Center),this._currentY+=36}renderTableHeader(e,t,r){let n=this._currentX;const i=this._maxWidth;e.fillStyle=ge._grey1,e.fillRect(this._currentX,this._currentY,i,22),e.fillStyle=ge._blackColor,e.font="14px sans-serif";var s=50;if(t){e.font="12px sans-serif";for(let i=0;i<t.length;i++)r&&(s=r[i]),C(e,t[i],n,this._currentY,s,22,w.Center),n+=s}this._currentY+=22}renderKeywords(e,t){e.font="14px sans-serif",C(e,"KEYWORDS",this._currentX+20,this._currentY,100,16,w.Left),e.font="12px serif";const r=[...t._keywords].join(", ").toLocaleUpperCase();this._currentY=x(e,r,this._currentX+190,this._currentY,500),this._currentY+=4}renderUnitStats(e,t,r,n){let i=50,s=this._currentX,o=0;e.fillStyle=n%2?ge._greyLight:"#ffffff",e.fillRect(s,this._currentY,this._maxWidth,22),e.fillStyle=ge._blackColor,e.font="12px sans-serif",r&&(i=r[o++]),C(e,t._name.toString(),s,this._currentY,i,22,w.Center),s+=i,r&&(i=r[o++]),C(e,t._move.toString(),s,this._currentY,i,22,w.Center),s+=i,r&&(i=r[o++]),C(e,t._wounds.toString(),s,this._currentY,i,22,w.Center),s+=i,r&&(i=r[o++]),C(e,t._toughness.toString(),s,this._currentY,i,22,w.Center),s+=i,this._currentY+=22}renderWeapons(e,t,r){e.font="12px sans-serif";e.save();let n=0,i=50;for(const s of t){let t=0,o=this._currentX,a=this._currentX,l=this._currentY;e.fillStyle=ge._blackColor,r&&(i=r[t++]),C(e,s._name.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._range.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._attacks.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._strength.toString(),o,this._currentY,i,22,w.Center),o+=i,r&&(i=r[t++]),C(e,s._damage,o,this._currentY,i,22,w.Center),o+=i,this._currentY+=22,e.save(),e.globalCompositeOperation="destination-over";const h=this._currentY-l;e.fillStyle=n%2?ge._greyLight:"#ffffff",e.fillRect(a,l,this._maxWidth,h),n++,e.restore()}e.restore()}renderBorder(e,t,r,n,i){e.strokeStyle=ge._blackColor,e.beginPath(),e.moveTo(t,r+ge._bevelSize),e.lineTo(t,r+i-ge._bevelSize),e.lineTo(t+ge._bevelSize,r+i),e.lineTo(t+n-ge._bevelSize,r+i),e.lineTo(t+n,r+i-ge._bevelSize),e.lineTo(t+n,r+ge._bevelSize),e.lineTo(t+n-ge._bevelSize,r),e.lineTo(t+ge._bevelSize,r),e.closePath(),e.stroke(),e.save(),e.fillStyle=ge._fillColor,e.globalCompositeOperation="destination-over",e.beginPath(),e.moveTo(t,r+ge._bevelSize),e.lineTo(t,r+i-ge._bevelSize),e.lineTo(t+ge._bevelSize,r+i),e.lineTo(t+n-ge._bevelSize,r+i),e.lineTo(t+n,r+i-ge._bevelSize),e.lineTo(t+n,r+ge._bevelSize),e.lineTo(t+n-ge._bevelSize,r),e.lineTo(t+ge._bevelSize,r),e.closePath(),e.fill(),e.restore()}renderLine(e){e.lineWidth=2,e.strokeStyle=ge._blackColor,e.beginPath(),e.moveTo(this._currentX,this._currentY),e.lineTo(this._currentX+this._maxWidth,this._currentY),e.stroke(),this._currentY+=1}}ge._res=144,ge._margin=0,ge._bevelSize=15,ge._blackColor="#1d272a",ge._grey1="#b3bbb5",ge._greyLight="#dde1df",ge._fillColor="#f6f6f6",ge._unitLabels=["UNIT","MOVE","WOUNDS","TOUGHNESS"],ge._weaponLabels=["WEAPON","RANGE","ATTACKS","STRENGTH","DAMAGE"];var be=r(1),ve=r.n(be);function ye(e){const t=e.split(".");return t.length>1?t[t.length-1].toLowerCase():""}function we(e){var t;let r=(new DOMParser).parseFromString(e,"text/xml");if(r){let e=r.querySelector("roster");if(e){const n=null===(t=e.getAttributeNode("gameSystemName"))||void 0===t?void 0:t.nodeValue;if(!n)return;const i=$("#roster-title")[0],s=$("#roster-lists")[0],o=$("#force-units")[0];if("Warhammer 40,000 8th Edition"==n||"Warhammer 40,000 9th Edition"==n){let e=_(r);if(e&&e._forces.length>0){new k(e).render(i,s,o)}}else if("Warhammer 40,000: Kill Team (2018)"==n){let e=_(r,!1);if(e&&e._forces.length>0){new k(e).render(i,s,o)}}else if("Age of Sigmar"==n){let e=ee(r);if(e){new ie(e).render(i,s,o)}}else if("Warhammer Age of Sigmar: Warcry"==n){let e=fe(r);if(e){new ge(e).render(i,s,o)}}else if("Warhammer 30,000 - The Horus Heresy"==n){let e=W(r);if(e&&e._forces.length>0){new F(e).render(i,s,o)}}else $("#errorText").html("PrettyScribe does not support game type '"+n+"'."),$("#errorDialog").modal()}}}$("#roster-file").on("change",(function(e){const t=e.target.files;if($("#roster-title").empty(),$("#roster-lists").empty(),$("#force-units").empty(),t){for(let e of t){const t=ye(e.name);if("rosz"===t||0===t.length){(new ve.a).loadAsync(e).then((function(e){e.forEach((function(e,t){t.async("text").then((function(e){we(e)}))}))})).catch((function(t){$("#errorText").html("Failed to load compressed roster file, "+e.name+", reason "+t),$("#errorDialog").modal()}))}else if("ros"===t){const t=new FileReader;t.onload=function(e){const t=e.target;if(t&&t.result){let e=t.result;const r=e.toString().indexOf(",")+1;we(window.atob(e.toString().slice(r)))}},t.readAsDataURL(e)}else $("#errorText").html("PrettyScribe only supports .ros and .rosz files.  Selected file is a '"+t+"' file."),$("#errorDialog").modal()}}}))}]);