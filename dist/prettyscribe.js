!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);class n{constructor(){this._name="",this._range="Melee",this._type="Melee",this._str="user",this._ap="",this._damage="",this._abilities=""}}class i{constructor(){this._name="",this._table=new Map}}class s{constructor(){this._name="",this._diceRoll="",this._distance="",this._mortalWounds=""}}class o{constructor(){this._name="",this._manifest=0,this._range="",this._details=""}}var l;!function(e){e[e.NONE=0]="NONE",e[e.HQ=1]="HQ",e[e.TR=2]="TR",e[e.EL=3]="EL",e[e.FA=4]="FA",e[e.HS=5]="HS",e[e.FL=6]="FL",e[e.DT=7]="DT",e[e.FT=8]="FT",e[e.LW=9]="LW",e[e.COMMANDER=10]="COMMANDER",e[e.LEADER=11]="LEADER",e[e.SPECIALIST=12]="SPECIALIST",e[e.NON_SPECIALIST=13]="NON_SPECIALIST"}(l||(l={}));const a=["None","HQ","Troops","Elites","Fast Attack","Heavy Support","Flyer","Dedicated Transport","Fortification","Lord of War","Commander","Leader","Specialist","Non-specialist"];class c{constructor(){this._name="",this._count=0,this._move='0"',this._ws="",this._bs="",this._str=4,this._toughness=4,this._wounds=1,this._attacks="",this._leadership=7,this._save="",this._weapons=[],this._psychicPowers=[],this._explosions=[]}}class _{constructor(){this._name="",this._role=l.NONE,this._factions=new Set,this._keywords=new Set,this._abilities=new Map,this._rules=new Map,this._models=[],this._points=0,this._powerLevel=0,this._commandPoints=0,this._woundTracker=[]}}class h{constructor(){this._catalog="",this._name="Unknown",this._faction="Unknown",this._rules=new Map,this._units=[]}}class d{constructor(){this._powerLevel=0,this._commandPoints=0,this._points=0,this._name="",this._forces=[]}}function u(e,t=!0){var r;if(e){var n=e.querySelector("roster");if(n){const i=new d,s=null===(r=n.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue;return i._name=s||"40k Army Roster",function(e,t){var r,n,i=e.querySelectorAll("roster>costs>cost");for(let e of i)if(e.hasAttribute("name")&&e.hasAttribute("value")){let i=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,s=null===(n=e.getAttributeNode("value"))||void 0===n?void 0:n.nodeValue;s&&(" PL"==i?t._powerLevel=+s:"pts"===i?t._points=+s:"CP"===i&&(t._commandPoints=+s))}}(e,i),function(e,t,r){var n,i,s,o=e.querySelectorAll("roster>forces>force");for(let e of o)if(e.hasAttribute("name")&&e.hasAttribute("catalogueName")){let o=new h,c=null===(n=e.getAttributeNode("name"))||void 0===n?void 0:n.nodeValue,_=null===(i=e.getAttributeNode("catalogueName"))||void 0===i?void 0:i.nodeValue;c&&(o._name=c),_&&(o._catalog=_);var l=e.querySelectorAll("force>rules>rule");for(let e of l)if(e.hasAttribute("name")){let t=null===(s=e.getAttributeNode("name"))||void 0===s?void 0:s.nodeValue;var a=e.querySelector("rule>description");t&&a&&o._rules.set(t,a.textContent)}f(e,o,r),t._forces.push(o)}}(e,i,t),i}}return null}function f(e,t,r){var n=e.querySelectorAll("force>selections>selection");for(let e of n){var i=b(e,r);i&&i._role!=l.NONE&&t._units.push(i)}t._units.sort((e,t)=>e._role>t._role?1:e._role==t._role?0:-1)}function m(e){switch(e){case"HQ":return l.HQ;case"Troops":return l.TR;case"Elites":return l.EL;case"Fast Attack":return l.FA;case"Heavy Support":return l.HS;case"Flyer":return l.FL;case"Dedicated Transport":return l.DT;case"Fortification":return l.FT;case"Lord of War":return l.LW}return l.NONE}function p(e){switch(e){case"Commander":return l.COMMANDER;case"Leader":return l.LEADER;case"Specialist":return l.SPECIALIST;case"Non-specialist":return l.NON_SPECIALIST}return l.NONE}function b(e,t){var r,a,h,d,u,f,b,g,S,v,C,T,L,A,y,E=new _,x=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue;x&&(E._name=x);var Y=e.querySelectorAll(":scope categories>category");for(let e of Y){let r=null===(a=e.getAttributeNode("name"))||void 0===a?void 0:a.nodeValue;if(r){const e="Faction: ",n=r.lastIndexOf(e);if(n>=0){const t=r.slice(n+e.length);E._factions.add(t)}else{const e=r.trim();var w=m(e);w!=l.NONE?E._role=w:t?E._keywords.add(r):(w=p(e))!=l.NONE?E._role=w:E._keywords.add(r)}}}var N=e.querySelectorAll(":scope profiles>profile");for(let e of N){let t=null===(h=e.getAttributeNode("name"))||void 0===h?void 0:h.nodeValue,r=null===(d=e.getAttributeNode("typeName"))||void 0===d?void 0:d.nodeValue;if(t&&r)if("Unit"===r||"Model"===r){var W=new c;W._name=t;let r=e.querySelectorAll("characteristics>characteristic");for(let t of r){let r=null===(u=t.getAttributeNode("name"))||void 0===u?void 0:u.nodeValue;if(r&&t.textContent)switch(r){case"M":W._move=t.textContent;break;case"WS":W._ws=t.textContent;break;case"BS":W._bs=t.textContent;break;case"S":W._str=+t.textContent;break;case"T":W._toughness=+t.textContent;break;case"W":W._wounds=+t.textContent;break;case"A":W._attacks=t.textContent;break;case"Ld":W._leadership=+t.textContent;break;case"Save":W._save=t.textContent}if(e.parentElement&&e.parentElement.parentElement){let t=null===(f=e.parentElement.parentElement.getAttributeNode("number"))||void 0===f?void 0:f.nodeValue;t&&(W._count=+t)}}E._models.push(W)}else if("Abilities"===r||"Wargear"===r||"Ability"===r){let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(b=e.getAttributeNode("name"))||void 0===b?void 0:b.nodeValue;r&&e.textContent&&t&&("Description"!==r&&"Ability"!==r||E._abilities.set(t,e.textContent))}}else if("Weapon"===r){let r=new n;r._name=t;let i=e.querySelectorAll("characteristics>characteristic");for(let e of i){let t=null===(g=e.getAttributeNode("name"))||void 0===g?void 0:g.nodeValue;if(t&&e.textContent)switch(t){case"Range":r._range=e.textContent;break;case"Type":r._type=e.textContent;break;case"S":r._str=e.textContent;break;case"AP":r._ap=e.textContent;break;case"D":r._damage=e.textContent;break;case"Abilities":r._abilities=e.textContent}}E._models.length&&E._models[E._models.length-1]._weapons.push(r)}else if(r.includes("Wound Track")){let r=new i;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let n=null===(S=e.getAttributeNode("name"))||void 0===S?void 0:S.nodeValue;n&&t&&(e.textContent?r._table.set(n,e.textContent):r._table.set(n,"-"))}E._woundTracker.push(r)}else if("Transport"==r){let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(v=e.getAttributeNode("name"))||void 0===v?void 0:v.nodeValue;r&&e.textContent&&t&&"Capacity"===r&&E._abilities.set(t,e.textContent)}}else if("Psychic Power"==r){let r=new o;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let t=null===(C=e.getAttributeNode("name"))||void 0===C?void 0:C.nodeValue;if(t&&e.textContent)switch(t){case"Range":r._range=e.textContent;break;case"Warp Charge":r._manifest=+e.textContent;break;case"Details":r._details=e.textContent}}E._models[E._models.length-1]._psychicPowers.push(r)}else if("Explosion"==r){let r=new s;r._name=t;let n=e.querySelectorAll("characteristics>characteristic");for(let e of n){let t=null===(T=e.getAttributeNode("name"))||void 0===T?void 0:T.nodeValue;if(t&&e.textContent)switch(t){case"Dice Roll":r._diceRoll=e.textContent;break;case"Distance":r._distance=e.textContent;break;case"Mortal Wounds":r._mortalWounds=e.textContent}}E._models[E._models.length-1]._explosions.push(r)}else console.log("Unknown profile type: "+r)}var k=e.querySelectorAll(":scope costs>cost");for(let e of k)if(e.hasAttribute("name")&&e.hasAttribute("value")){let t=null===(L=e.getAttributeNode("name"))||void 0===L?void 0:L.nodeValue,r=null===(A=e.getAttributeNode("value"))||void 0===A?void 0:A.nodeValue;r&&(" PL"==t?E._powerLevel+=+r:"pts"==t?E._points+=+r:"CP"==t&&(E._commandPoints+=+r))}var M=e.querySelectorAll(":scope rules > rule");for(let e of M)if(e.hasAttribute("name")){let t=null===(y=e.getAttributeNode("name"))||void 0===y?void 0:y.nodeValue;var R=e.querySelector("description");t&&R&&R.textContent&&E._rules.set(t,R.textContent)}return E}var g,S;function v(e,t,r,n,i,s,o){if(e&&t.length){e.textBaseline="top";let l=e.measureText(t);const a=l.width,c=l.actualBoundingBoxDescent-l.actualBoundingBoxAscent;o==g.Center?e.fillText(t,r+(i-a)/2,n+(s-c)/2):o==g.Left?e.fillText(t,r,n+(s-c)/2):o==g.Right&&e.fillText(t,r+i-a,n+(s-c)/2)}}function C(e,t,r,n,i){let s=n;if(e&&t.length){let n=[],o=[];e.textBaseline="top";let l=0;const a=e.measureText(" ").width,c=e.measureText(t),_=1.2*(c.actualBoundingBoxDescent-c.actualBoundingBoxAscent);t.split(" ").forEach((function(t){const r=e.measureText(t);l+r.width>i&&(n.push(o.join(" ")),o.length=0,l=0),l+=r.width+a,o.push(t)})),o.length>0&&n.push(o.join(" "));for(let t of n)e.fillText(t,r,s),s+=_}return s}!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center"}(g||(g={}));class T{constructor(e){this._roster=null,this._currentX=0,this._currentY=0,this._maxWidth=0,this._maxHeight=0,this._octagon=null,this._roles=new Map,this._unitLabelWidthsNormalized=[.3,.077,.077,.077,.077,.077,.077,.077,.077,.077],this._weaponLabelWidthNormalized=[.3,.077,.077,.077,.077,.077,.3],this._spellLabelWidthNormalized=[.3,.1,.1,.5],this._explosionLabelWidthNormalized=[.3,.15,.15,.15],this._trackerLabelWidth=[.3,.2,.15,.15,.15],this._roster=e,this._octagon=document.getElementById("octagon"),this._roles.set(l.HQ,document.getElementById("role_hq")),this._roles.set(l.TR,document.getElementById("role_tr")),this._roles.set(l.EL,document.getElementById("role_el")),this._roles.set(l.FA,document.getElementById("role_fa")),this._roles.set(l.HS,document.getElementById("role_hs")),this._roles.set(l.FL,document.getElementById("role_fl")),this._roles.set(l.DT,document.getElementById("role_dt")),this._roles.set(l.FT,document.getElementById("role_ft")),this._roles.set(l.LW,document.getElementById("role_lw"))}render(e,t,r){var n;if(null!=this._roster){e&&(e.innerHTML="<h3>"+this._roster._name+" ("+this._roster._points+" pts, "+this._roster._powerLevel+" PL, "+this._roster._commandPoints+" CP)</h3>");for(let e of this._roster._forces){const i=document.createElement("div");i&&(i.innerHTML="<p>"+e._catalog+" "+e._name+"</p>"),t&&t.appendChild(i);const s=document.createElement("table");s.classList.add("table"),s.classList.add("table-sm"),s.classList.add("table-striped");const o=document.createElement("thead");s.appendChild(o),o.classList.add("thead-light");const l=document.createElement("tr");o.appendChild(l),[{name:"NAME",w:"25%"},{name:"ROLE",w:"20%"},{name:"MODELS",w:"25%"},{name:"POINTS",w:"15%"},{name:"POWER",w:"15%"}].forEach(e=>{let t=document.createElement("th");t.scope="col",t.innerHTML=e.name,t.style.width=e.w,l.appendChild(t)}),i.appendChild(s);let c=document.createElement("tbody");s.appendChild(c);for(let t of e._units){let e=document.createElement("tr"),r=document.createElement("td");r.innerHTML=t._name;let n=document.createElement("td");n.innerHTML=a[t._role];let i=document.createElement("td");i.innerHTML="";let s=0;for(const e of t._models)e._count>1?i.innerHTML+=e._count+" "+e._name:i.innerHTML+=e._name,s++,s!=t._models.length&&(i.innerHTML+=",  ");let o=document.createElement("td");o.innerHTML=t._points.toString();let l=document.createElement("td");l.innerHTML=t._powerLevel.toString(),e.appendChild(r),e.appendChild(n),e.appendChild(i),e.appendChild(o),e.appendChild(l),c.appendChild(e)}for(let t of e._units){let e=document.createElement("canvas");e.width=5.5*T._res,e.height=8.5*T._res;const i=this.renderUnit(t,e,0,0),s=25;let o=document.createElement("canvas");o.width=i[0]+2*s,o.height=i[1]+2*s,null===(n=o.getContext("2d"))||void 0===n||n.drawImage(e,s,s),r&&r.appendChild(o)}}}}renderBorder(e,t,r,n,i){e.strokeStyle=T._blackColor,e.beginPath(),e.moveTo(t,r+T._bevelSize),e.lineTo(t,r+i-T._bevelSize),e.lineTo(t+T._bevelSize,r+i),e.lineTo(t+n-T._bevelSize,r+i),e.lineTo(t+n,r+i-T._bevelSize),e.lineTo(t+n,r+T._bevelSize),e.lineTo(t+n-T._bevelSize,r),e.lineTo(t+T._bevelSize,r),e.closePath(),e.stroke(),e.save(),e.fillStyle=T._fillColor,e.globalCompositeOperation="destination-over",e.beginPath(),e.moveTo(t,r+T._bevelSize),e.lineTo(t,r+i-T._bevelSize),e.lineTo(t+T._bevelSize,r+i),e.lineTo(t+n-T._bevelSize,r+i),e.lineTo(t+n,r+i-T._bevelSize),e.lineTo(t+n,r+T._bevelSize),e.lineTo(t+n-T._bevelSize,r),e.lineTo(t+T._bevelSize,r),e.closePath(),e.fill(),e.restore()}renderWatermark(e){}renderLine(e){e.lineWidth=2,e.strokeStyle=T._blackColor,e.beginPath(),e.moveTo(this._currentX,this._currentY),e.lineTo(this._currentX+this._maxWidth,this._currentY),e.stroke(),this._currentY+=1}renderTableHeader(e,t,r){let n=this._currentX;const i=this._maxWidth;e.fillStyle=T._grey1,e.fillRect(this._currentX,this._currentY,i,22),e.fillStyle=T._blackColor,e.font="14px sans-serif";var s=50;if(t){e.font="12px sans-serif";for(let i=0;i<t.length;i++)r&&(s=r[i]),v(e,t[i],n,this._currentY,s,22,g.Center),n+=s}this._currentY+=22}renderSpells(e,t,r){e.font="12px sans-serif";let n=0,i=50;e.save();for(const s of t){let t=0,o=this._currentX,l=this._currentX,a=this._currentY;e.fillStyle=T._blackColor,r&&(i=r[t++]),v(e,s._name.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._manifest.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._range.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),this._currentY=C(e,s._details,o,this._currentY,i),o+=i,e.save(),e.fillStyle=n%2?T._greyLight:"#ffffff",e.globalCompositeOperation="destination-over";const c=this._currentY-a;e.fillRect(l,a,this._maxWidth,c),n++,e.restore()}e.restore()}renderExplosion(e,t,r){e.font="12px sans-serif";let n=0,i=50;for(const s of t){let t=0,o=this._currentX;e.fillStyle=n%2?T._greyLight:"#ffffff",e.fillRect(o,this._currentY,this._maxWidth,22),n++,e.fillStyle=T._blackColor,r&&(i=r[t++]),v(e,s._name,o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._diceRoll,o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._distance,o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._mortalWounds,o,this._currentY,i,22,g.Center),o+=i,this._currentY+=22}}renderWeapons(e,t,r){e.font="12px sans-serif";e.save();let n=0,i=50;for(const s of t){let t=0,o=this._currentX,l=this._currentX,a=this._currentY;e.fillStyle=T._blackColor,r&&(i=r[t++]),v(e,s._name.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._range.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._type.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._str.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._ap.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._damage.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),s._abilities?(this._currentY+=4,this._currentY=C(e,s._abilities,o,this._currentY,i),this._currentY+=2):this._currentY+=22,o+=i,e.save(),e.globalCompositeOperation="destination-over";const c=this._currentY-a;e.fillStyle=n%2?T._greyLight:"#ffffff",e.fillRect(l,a,this._maxWidth,c),n++,e.restore()}e.restore()}renderModel(e,t,r,n){let i=50,s=this._currentX,o=0;e.fillStyle=n%2?T._greyLight:"#ffffff",e.fillRect(s,this._currentY,this._maxWidth,24),e.fillStyle=T._blackColor,e.font="12px sans-serif",r&&(i=r[o++]),v(e,t._name.toString(),s,this._currentY,i,24,g.Center),s+=i,r&&(i=r[o++]),v(e,t._move.toString(),s,this._currentY,i,24,g.Center),s+=i,r&&(i=r[o++]),v(e,t._ws.toString(),s,this._currentY,i,24,g.Center),s+=i,r&&(i=r[o++]),v(e,t._bs.toString(),s,this._currentY,i,24,g.Center),s+=i,r&&(i=r[o++]),v(e,t._str.toString(),s,this._currentY,i,24,g.Center),s+=i,r&&(i=r[o++]),v(e,t._toughness.toString(),s,this._currentY,i,24,g.Center),s+=i,r&&(i=r[o++]),v(e,t._wounds.toString(),s,this._currentY,i,24,g.Center),s+=i,r&&(i=r[o++]),v(e,t._attacks.toString(),s,this._currentY,i,24,g.Center),s+=i,r&&(i=r[o++]),v(e,t._leadership.toString(),s,this._currentY,i,24,g.Center),s+=i,r&&(i=r[o++]),v(e,t._save.toString(),s,this._currentY,i,24,g.Center),s+=i,this._currentY+=24}renderAbilities(e,t){e.font="14px sans-serif",v(e,"ABILITIES",this._currentX+20,this._currentY,100,16,g.Left),e.font="12px serif";for(let r of t._abilities){const t=r[0].toUpperCase(),n=r[1];this._currentY+=2,this._currentY=C(e,t+": "+n,this._currentX+190,this._currentY,600),this._currentY+=2}}renderRules(e,t){e.font="14px sans-serif",v(e,"RULES",this._currentX+20,this._currentY,100,16,g.Left),e.font="12px serif";for(let r of t._rules){const t=r[0].toUpperCase(),n=r[1];this._currentY+=2,this._currentY=C(e,t+": "+n,this._currentX+190,this._currentY,600),this._currentY+=4}}renderKeywords(e,t){e.font="14px sans-serif",v(e,"KEYWORDS",this._currentX+20,this._currentY,100,16,g.Left),e.font="12px serif";const r=[...t._keywords].join(", ").toLocaleUpperCase();this._currentY+=2,this._currentY=C(e,r,this._currentX+190,this._currentY,600),this._currentY+=2}renderFactions(e,t){e.font="14px sans-serif",v(e,"FACTIONS",this._currentX+20,this._currentY,100,16,g.Left),e.font="12px serif";const r=[...t._factions].join(", ").toLocaleUpperCase();this._currentY+=2,this._currentY=C(e,r,this._currentX+190,this._currentY,600),this._currentY+=2}renderWoundTable(e,t,r){let n=50;for(let i of t._woundTracker){let t=this._currentX,s=0;e.fillStyle=T._greyLight,e.fillRect(t,this._currentY,this._maxWidth,22),e.fillStyle=T._blackColor,e.font="12px sans-serif",r&&(n=r[s++]),t+=n;for(let o of i._table)r&&(n=r[s++]),v(e,o[1],t,this._currentY,n,22,g.Center),t+=n;this._currentY+=22}}renderModelList(e,t){e.font="14px sans-serif",v(e,"MODELS",this._currentX+20,this._currentY,100,16,g.Left),e.font="12px serif";let r="",n=0;for(const e of t._models)e._count>1?r+=e._count+" "+e._name:r+=e._name,n++,n!=t._models.length&&(r+=",  ");this._currentY+=2,this._currentY=C(e,r,this._currentX+190,this._currentY,600),this._currentY+=2}renderWoundBoxes(e,t){e.save();for(let r of t._models)if(r._wounds>1){let t=this._currentY;e.font="14px sans-serif",e.fillStyle=T._blackColor,this._currentY=C(e,r._name,this._currentX+80,this._currentY+8,250);let n=this._currentX+340;e.strokeStyle=T._blackColor,e.fillStyle="#ffffff";for(let i=0;i<r._wounds;i++)i%10==0&&0!=i&&(t+=40,n=this._currentX+340),e.fillRect(n,t,30,30),e.strokeRect(n,t,30,30),n+=40;t+=40,this._currentY=t}e.restore()}renderUnit(e,t,r,n){let i=t.getContext("2d");if(!i)return[0,0];this._currentX=r+T._margin,this._currentY=n+T._margin,this._maxWidth=t.width-this._currentX,this._maxHeight=Math.max(0,t.height-this._currentY),this.renderHeader(e,i),i.fillStyle=T._blackColor;let s=[],o=[],l=[];const a=[];this._unitLabelWidthsNormalized.forEach(e=>{a.push(e*this._maxWidth)}),this.renderTableHeader(i,T._unitLabels,a);let c=0;for(var _ of e._models){this.renderModel(i,_,a,c%2),c++;for(let e of _._weapons)s.push(e);for(let e of _._psychicPowers)o.push(e);for(let e of _._explosions)l.push(e)}const h=[],d=new Map;for(const e of s)d.has(e._name)||(d.set(e._name,e),h.push(e));if(h.length>0){const e=[];this._weaponLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,T._weaponLabels,e),this.renderWeapons(i,h,e)}if(o.length>0){const e=[];this._spellLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,T._spellLabels,e),this.renderSpells(i,o,e)}if(e._abilities.size>0&&(this.renderLine(i),this._currentY+=2,this.renderAbilities(i,e)),e._rules.size>0&&(this.renderLine(i),this._currentY+=2,this.renderRules(i,e)),e._factions.size>0&&(this.renderLine(i),this._currentY+=2,this.renderFactions(i,e)),e._keywords.size>0&&(this.renderLine(i),this._currentY+=2,this.renderKeywords(i,e)),e._models.length>0&&(this.renderLine(i),this._currentY+=2,this.renderModelList(i,e)),e._woundTracker.length>0){this.renderLine(i);const t=[];this._trackerLabelWidth.forEach(e=>{t.push(e*this._maxWidth)}),this.renderTableHeader(i,T._trackerLabels,t),this.renderWoundTable(i,e,t)}if(l.length>0){this.renderLine(i);const e=[];this._explosionLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderTableHeader(i,T._explosionLabels,e),this.renderExplosion(i,l,e)}let u=!1;for(let t of e._models)t._wounds>1&&(u=!0);u&&(this.renderLine(i),this._currentY+=5,this.renderWoundBoxes(i,e));const f=this._currentY-(n+T._margin),m=this._maxWidth;return this.renderBorder(i,this._currentX,n+T._margin,m,f),this.renderWatermark(i),[this._maxWidth,this._currentY]}renderHeader(e,t){t.globalAlpha=1,t.fillStyle=T._blackColor;const r=this._currentX,n=this._currentX+this._maxWidth,i=this._currentY,s=i+36;t.beginPath(),t.moveTo(r,i+T._bevelSize),t.lineTo(r,s),t.lineTo(n,s),t.lineTo(n,i+T._bevelSize),t.lineTo(n-T._bevelSize,i),t.lineTo(r+T._bevelSize,i),t.closePath(),t.fill();let o=r+6;if(this._octagon){t.drawImage(this._octagon,o,i+2,32,32);const r=this._roles.get(e._role);r&&t.drawImage(r,o+4,i+2+4,24,24),t.fillStyle="white",t.font="18px serif",o+=34,t.drawImage(this._octagon,o,i+2,32,32),v(t,e._powerLevel.toString(),o,i+2,32,32,g.Center),o+=34,t.drawImage(this._octagon,o,i+2,32,32),v(t,e._points.toString(),o,i+2,32,32,g.Center)}let l=0,a=28;const c=o+6;t.font=a+"px bold serif";const _=e._name.toLocaleUpperCase();let h=t.measureText(_);const d=this._maxWidth-c;for(;l<6&&h.width>d;)l+=1,a-=2,t.font=a+"px bold serif",h=t.measureText(_);t.fillStyle="white",t.textBaseline="top",v(t,_,c,i,d,36,g.Center),this._currentY+=36}}T._res=144,T._margin=0,T._bevelSize=15,T._blackColor="#1d272a",T._grey1="#b3bbb5",T._greyLight="#dde1df",T._fillColor="#f6f6f6",T._unitLabels=["MODEL","M","WS","BS","S","T","W","A","LD","SAVE"],T._weaponLabels=["WEAPONS","RANGE","TYPE","S","AP","D","ABILITIES"],T._spellLabels=["PSYCHIC POWER","MANIFEST","RANGE","DETAILS"],T._explosionLabels=["EXPLOSION","DICE ROLL","DISTANCE","MORTAL WOUNDS"],T._trackerLabels=["WOUND TRACK","REMAINING W","ATTRIBUTE","ATTRIBUTE","ATTRIBUTE"];class L{constructor(){this._name="",this._type="Melee",this._range="",this._attacks="",this._toHit="",this._toWound="",this._rend="",this._damage=""}}class A{constructor(){this._name="",this._castingValue=0,this._description=""}}class y{constructor(){this._name="",this._description=""}}class E{constructor(){this._name="",this._battleTraits=new Map,this._commandAbilities=new Map}}!function(e){e[e.NONE=0]="NONE",e[e.LEADER=1]="LEADER",e[e.BATTLELINE=2]="BATTLELINE",e[e.BEHEMOTH=3]="BEHEMOTH",e[e.ARTILLERY=4]="ARTILLERY",e[e.OTHER=5]="OTHER",e[e.SCENERY=6]="SCENERY",e[e.BATTALION=7]="BATTALION",e[e.MALIGN_SORCERY=8]="MALIGN_SORCERY",e[e.REALM=9]="REALM"}(S||(S={}));const x=["None","Leader","Battleline","Behemoth","Artillery","Other","Scenery","Battalion","Malign Sorcery","Realm"];class Y{constructor(){this._name="",this._role=S.NONE,this._keywords=new Set,this._abilities=new Map,this._commandAbilities=new Map,this._commandTraits=new Map,this._magic=new Map,this._artefacts=new Map,this._count=0,this._move='0"',this._wounds=1,this._bravery=7,this._save="",this._weapons=[],this._spells=[],this._prayers=[],this._points=0,this._woundTracker=null}}class w{constructor(){this._catalog="",this._name="Unknown",this._units=[],this._allegiance=new E}}class N{constructor(){this._commandPoints=0,this._points=0,this._name="",this._forces=[]}}function W(e){switch(e){case"Leader":return S.LEADER;case"Battleline":return S.BATTLELINE;case"Other":return S.OTHER;case"Behemoth":return S.BEHEMOTH;case"Artillery":return S.ARTILLERY;case"Scenery":return S.SCENERY;case"Battalion":return S.BATTALION;case"Malign Sorcery":return S.MALIGN_SORCERY;case"Realm":return S.REALM}return S.NONE}function k(e){var t;if(e){let r=e.querySelector("roster");if(r){const n=new N,i=null===(t=r.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue;return n._name=i||"Age of Sigmar Roster",function(e,t){var r,n;let i=e.querySelectorAll("roster>costs>cost");for(let e of i)if(e.hasAttribute("name")&&e.hasAttribute("value")){let i=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,s=null===(n=e.getAttributeNode("value"))||void 0===n?void 0:n.nodeValue;s&&"pts"===i&&(t._points=+s)}}(e,n),function(e,t){var r,n;let i=e.querySelectorAll("roster>forces>force");for(let e of i)if(e.hasAttribute("name")&&e.hasAttribute("catalogueName")){let i=new w,s=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,o=null===(n=e.getAttributeNode("catalogueName"))||void 0===n?void 0:n.nodeValue;s&&(i._name=s),o&&(i._catalog=o),M(e,i),t._forces.push(i)}console.log(t)}(e,n),n}}return null}function M(e,t){var r,n;let i=e.querySelectorAll("force>selections>selection");for(let e of i){if(!(null===(r=e.getAttributeNode("type"))||void 0===r?void 0:r.nodeValue))continue;let i=null===(n=e.getAttributeNode("name"))||void 0===n?void 0:n.nodeValue;if(i&&i.includes("Allegiance")){let r=I(e);r&&(t._allegiance=r)}else{let r=R(e);r&&r._role!=S.NONE&&t._units.push(r)}}t._units.sort((e,t)=>e._role>t._role?1:e._role==t._role?0:-1)}function R(e){var t,r,n,i,s,o,l,a,c,_,h;let d=new Y,u=e.querySelectorAll("profiles>profile");for(let e of u){let a=null===(t=e.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue,c=null===(r=e.getAttributeNode("typeName"))||void 0===r?void 0:r.nodeValue;if(a&&c)if("Unit"==c){d._name=a;let t=e.querySelectorAll("characteristics>characteristic");for(let e of t){let t=null===(n=e.getAttributeNode("name"))||void 0===n?void 0:n.nodeValue;if(t&&e.textContent)switch(t){case"Move":d._move=e.textContent;break;case"Wounds":d._wounds=+e.textContent;break;case"Bravery":d._bravery=+e.textContent;break;case"Save":d._save=e.textContent}}}else if("Unit Abilities"==c){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._abilities.set(a,t.textContent)}else if("Command Abilities"==c){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._commandAbilities.set(a,t.textContent)}else if("Magic"==c){let t=e.querySelectorAll("characteristics>characteristic");for(let e of t){let t=null===(i=e.getAttributeNode("name"))||void 0===i?void 0:i.nodeValue;t&&e.textContent&&d._magic.set(t,e.textContent)}}else if("Unit Leader"==c){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._abilities.set(c,t.textContent)}else if("Spell"==c){let t=new A;t._name=a;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(s=e.getAttributeNode("name"))||void 0===s?void 0:s.nodeValue;if(r&&e.textContent)switch(r){case"Casting Value":t._castingValue=+e.textContent;break;case"Description":t._description=e.textContent}}d._spells.push(t)}else if("Weapon"==c){let t=new L;t._name=a;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(o=e.getAttributeNode("name"))||void 0===o?void 0:o.nodeValue;if(r&&e.textContent)switch(r){case"Range":t._range=e.textContent;break;case"Type":t._type=e.textContent;break;case"Attacks":t._attacks=e.textContent;break;case"Rend":t._rend=e.textContent;break;case"To Hit":t._toHit=e.textContent;break;case"To Wound":t._toWound=e.textContent;break;case"Damage":t._damage=e.textContent}}d._weapons.push(t)}else if("Command Trait"==c){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._commandTraits.set(a,t.textContent)}else if("Artefact"==c){let t=e.querySelector("characteristics>characteristic");t&&t.textContent&&d._artefacts.set(a,t.textContent)}else if("Prayer"==c){let t=new y;t._name=a;let r=e.querySelectorAll("characteristics>characteristic");for(let e of r){let r=null===(l=e.getAttributeNode("name"))||void 0===l?void 0:l.nodeValue;if(r&&e.textContent)switch(r){case"Description":t._description=e.textContent}}d._prayers.push(t)}else c.includes("Wound Track")||c.includes("Damage Table")||console.log("Unknown unit profile type: "+c)}let f=e.querySelectorAll("costs>cost");for(let e of f)if(e.hasAttribute("name")&&e.hasAttribute("value")){let t=null===(a=e.getAttributeNode("name"))||void 0===a?void 0:a.nodeValue,r=null===(c=e.getAttributeNode("value"))||void 0===c?void 0:c.nodeValue;r&&"pts"===t&&(d._points+=+r)}let m=e.querySelectorAll(":scope categories>category");for(let e of m){let t=null===(_=e.getAttributeNode("name"))||void 0===_?void 0:_.nodeValue;null===(h=e.getAttributeNode("primary"))||void 0===h||h.nodeValue;if(t){var p=W(t.trim());p!=S.NONE?d._role=p:d._keywords.add(t)}}return d}function I(e){var t,r,n,i,s;let o=null,l=e.querySelector("selections>selection");if(l){let e=null===(t=l.getAttributeNode("name"))||void 0===t?void 0:t.nodeValue;e&&(o=new E,o._name=e);let a=l.querySelectorAll("profiles>profile");for(let e of a){let t=null===(r=e.getAttributeNode("name"))||void 0===r?void 0:r.nodeValue,l=null===(n=e.getAttributeNode("typeName"))||void 0===n?void 0:n.nodeValue;if(t&&l)if("Battle Trait"==l){let r=e.querySelector("characteristics>characteristic");if(r){let e=r.textContent;e&&(null===(i=o)||void 0===i||i._battleTraits.set(t,e))}}else if("Command Abilities"==l){let r=e.querySelector("characteristics>characteristic");if(r){let e=r.textContent;e&&(null===(s=o)||void 0===s||s._commandAbilities.set(t,e))}}else console.log("Unexpected allegiance profile type: "+l)}}return o}class O{constructor(e){this._roster=null,this._currentX=0,this._currentY=0,this._maxWidth=0,this._maxHeight=0,this._unitLabelWidthsNormalized=[.4,.15,.15,.15,.15],this._weaponLabelWidthNormalized=[.4,.1,.1,.1,.1,.1,.1],this._spellLabelWidthNormalized=[.3,.2,.5],this._prayerLabelWidthNormalized=[.4,.6],this._trackerLabelWidth=[.3,.2,.15,.15,.15],this._roster=e}render(e,t,r){var n;if(null!=this._roster){e&&(e.innerHTML="<h3>"+this._roster._name+" ("+this._roster._points+" pts, "+this._roster._commandPoints+" CP)</h3>");for(let e of this._roster._forces){const i=document.createElement("div");i&&(i.innerHTML="<p>"+e._catalog+" "+e._name+"</p>"),t&&t.appendChild(i);const s=document.createElement("table");s.classList.add("table"),s.classList.add("table-sm"),s.classList.add("table-striped");const o=document.createElement("thead");s.appendChild(o),o.classList.add("thead-light");const l=document.createElement("tr");o.appendChild(l),[{name:"NAME",w:"35%"},{name:"ROLE",w:"25%"},{name:"MODELS",w:"25%"},{name:"POINTS",w:"15%"}].forEach(e=>{let t=document.createElement("th");t.scope="col",t.innerHTML=e.name,t.style.width=e.w,l.appendChild(t)}),i.appendChild(s);let a=document.createElement("tbody");s.appendChild(a);for(let t of e._units){let e=document.createElement("tr"),r=document.createElement("td");r.innerHTML=t._name;let n=document.createElement("td");n.innerHTML=x[t._role];let i=document.createElement("td");i.innerHTML="";let s=document.createElement("td");s.innerHTML=t._points.toString(),e.appendChild(r),e.appendChild(n),e.appendChild(i),e.appendChild(s),a.appendChild(e)}for(let t of e._units){let e=document.createElement("canvas");e.width=5.5*O._res,e.height=8.5*O._res;const i=this.renderUnit(t,e,0,0),s=25;let o=document.createElement("canvas");o.width=i[0]+2*s,o.height=i[1]+2*s,null===(n=o.getContext("2d"))||void 0===n||n.drawImage(e,s,s),r&&r.appendChild(o)}}}}renderUnit(e,t,r,n){let i=t.getContext("2d");if(!i)return[0,0];this._currentX=r+O._margin,this._currentY=n+O._margin,this._maxWidth=t.width-this._currentX,this._maxHeight=Math.max(0,t.height-this._currentY),this.renderHeader(e,i);const s=[];this._unitLabelWidthsNormalized.forEach(e=>{s.push(e*this._maxWidth)}),this.renderTableHeader(i,O._unitLabels,s),this.renderUnitStats(i,e,s,0);const o=[],l=new Map;for(const t of e._weapons)l.has(t._name)||(l.set(t._name,t),o.push(t));let a=[],c=[];for(let e of o)"Melee"==e._type?c.push(e):a.push(e);if(a.length){const e=[];this._weaponLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,O._weaponLabels,e),this.renderWeapons(i,a,e)}if(c.length){const e=[];this._weaponLabelWidthNormalized.forEach(t=>{e.push(t*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,O._meleeLabels,e),this.renderWeapons(i,c,e)}if(e._spells.length>0){const t=[];this._spellLabelWidthNormalized.forEach(e=>{t.push(e*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,O._spellLabels,t),this.renderSpells(i,e._spells,t)}if(e._prayers.length>0){const t=[];this._prayerLabelWidthNormalized.forEach(e=>{t.push(e*this._maxWidth)}),this.renderLine(i),this.renderTableHeader(i,O._prayerLabels,t),this.renderPrayers(i,e._prayers,t)}if(e._abilities.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"ABILITIES",e._abilities)),e._commandAbilities.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"COMMAND ABILITIES",e._commandAbilities)),e._commandTraits.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"COMMAND TRAITS",e._commandTraits)),e._artefacts.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"ARTEFACTS",e._artefacts)),e._magic.size>0&&(this.renderLine(i),this._currentY+=2,this.renderMap(i,"MAGIC",e._magic)),e._woundTracker){this.renderLine(i);const t=[];this._trackerLabelWidth.forEach(e=>{t.push(e*this._maxWidth)}),this.renderTableHeader(i,e._woundTracker._woundTrackerLabels,t),this.renderWoundTable(i,e,t)}e._keywords.size>0&&(this.renderLine(i),this._currentY+=2,this.renderKeywords(i,e));const _=this._currentY-(n+O._margin),h=this._maxWidth;return this.renderBorder(i,this._currentX,n+O._margin,h,_),[this._maxWidth,this._currentY]}renderHeader(e,t){t.globalAlpha=1,t.fillStyle=O._blackColor;const r=this._currentX,n=this._currentX+this._maxWidth,i=this._currentY,s=i+36;t.beginPath(),t.moveTo(r,i+O._bevelSize),t.lineTo(r,s),t.lineTo(n,s),t.lineTo(n,i+O._bevelSize),t.lineTo(n-O._bevelSize,i),t.lineTo(r+O._bevelSize,i),t.closePath(),t.fill();let o=0,l=28;const a=r+6+6;t.font=l+"px bold serif";const c=e._name.toLocaleUpperCase();let _=t.measureText(c);const h=this._maxWidth-a;for(;o<6&&_.width>h;)o+=1,l-=2,t.font=l+"px bold serif",_=t.measureText(c);t.fillStyle="white",t.textBaseline="top",v(t,c,a,i,h,36,g.Center),this._currentY+=36}renderTableHeader(e,t,r){let n=this._currentX;const i=this._maxWidth;e.fillStyle=O._grey1,e.fillRect(this._currentX,this._currentY,i,22),e.fillStyle=O._blackColor,e.font="14px sans-serif";var s=50;if(t){e.font="12px sans-serif";for(let i=0;i<t.length;i++)r&&(s=r[i]),v(e,t[i],n,this._currentY,s,22,g.Center),n+=s}this._currentY+=22}renderKeywords(e,t){e.font="14px sans-serif",v(e,"KEYWORDS",this._currentX+20,this._currentY,100,16,g.Left),e.font="12px serif";const r=[...t._keywords].join(", ").toLocaleUpperCase();this._currentY=C(e,r,this._currentX+190,this._currentY,500),this._currentY+=4}renderLine(e){e.lineWidth=2,e.strokeStyle=O._blackColor,e.beginPath(),e.moveTo(this._currentX,this._currentY),e.lineTo(this._currentX+this._maxWidth,this._currentY),e.stroke(),this._currentY+=1}renderWeapons(e,t,r){e.font="12px sans-serif";e.save();let n=0,i=50;for(const s of t){let t=0,o=this._currentX,l=this._currentX,a=this._currentY;e.fillStyle=O._blackColor,r&&(i=r[t++]),v(e,s._name.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._range.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._attacks.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._toHit.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._toWound.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._rend.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._damage.toString(),o,this._currentY,i,22,g.Center),o+=i,this._currentY+=22,e.save(),e.globalCompositeOperation="destination-over";const c=this._currentY-a;e.fillStyle=n%2?O._greyLight:"#ffffff",e.fillRect(l,a,this._maxWidth,c),n++,e.restore()}e.restore()}renderMap(e,t,r){e.font="14px sans-serif",v(e,t,this._currentX+20,this._currentY,100,16,g.Left),e.font="12px serif";for(let t of r){const r=t[0].toUpperCase(),n=t[1];this._currentY+=2,this._currentY=C(e,r+": "+n,this._currentX+190,this._currentY,500)}this._currentY+=4}renderSpells(e,t,r){e.font="12px sans-serif";let n=0,i=50;e.save();for(const s of t){let t=0,o=this._currentX,l=this._currentX,a=this._currentY;e.fillStyle=O._blackColor,r&&(i=r[t++]),v(e,s._name.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),v(e,s._castingValue.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),this._currentY+=2,this._currentY=C(e,s._description,o,this._currentY,i),o+=i,e.save(),e.fillStyle=n%2?O._greyLight:"#ffffff",e.globalCompositeOperation="destination-over";const c=this._currentY-a;e.fillRect(l,a,this._maxWidth,c),n++,e.restore()}e.restore()}renderPrayers(e,t,r){e.font="12px sans-serif";let n=0,i=50;e.save();for(const s of t){let t=0,o=this._currentX,l=this._currentX,a=this._currentY;e.fillStyle=O._blackColor,r&&(i=r[t++]),v(e,s._name.toString(),o,this._currentY,i,22,g.Center),o+=i,r&&(i=r[t++]),this._currentY+=2,this._currentY=C(e,s._description,o,this._currentY,i),o+=i,e.save(),e.fillStyle=n%2?O._greyLight:"#ffffff",e.globalCompositeOperation="destination-over";const c=this._currentY-a;e.fillRect(l,a,this._maxWidth,c),n++,e.restore()}e.restore()}renderUnitStats(e,t,r,n){let i=50,s=this._currentX,o=0;e.fillStyle=n%2?O._greyLight:"#ffffff",e.fillRect(s,this._currentY,this._maxWidth,22),e.fillStyle=O._blackColor,e.font="12px sans-serif",r&&(i=r[o++]),v(e,t._name.toString(),s,this._currentY,i,22,g.Center),s+=i,r&&(i=r[o++]),v(e,t._move.toString(),s,this._currentY,i,22,g.Center),s+=i,r&&(i=r[o++]),v(e,t._wounds.toString(),s,this._currentY,i,22,g.Center),s+=i,r&&(i=r[o++]),v(e,t._bravery.toString(),s,this._currentY,i,22,g.Center),s+=i,r&&(i=r[o++]),v(e,t._save.toString(),s,this._currentY,i,22,g.Center),s+=i,this._currentY+=22}renderWoundTable(e,t,r){if(null==t._woundTracker)return;let n=50,i=this._currentX,s=0;e.fillStyle=O._greyLight,e.fillRect(i,this._currentY,this._maxWidth,22),e.fillStyle=O._blackColor,e.font="12px sans-serif",r&&(n=r[s++]),v(e,t._woundTracker._name,i,this._currentY,n,22,g.Center),i+=n;for(let o of t._woundTracker._table)r&&(n=r[s++]),v(e,o[1],i,this._currentY,n,22,g.Center),i+=n;this._currentY+=22}renderBorder(e,t,r,n,i){e.strokeStyle=O._blackColor,e.beginPath(),e.moveTo(t,r+O._bevelSize),e.lineTo(t,r+i-O._bevelSize),e.lineTo(t+O._bevelSize,r+i),e.lineTo(t+n-O._bevelSize,r+i),e.lineTo(t+n,r+i-O._bevelSize),e.lineTo(t+n,r+O._bevelSize),e.lineTo(t+n-O._bevelSize,r),e.lineTo(t+O._bevelSize,r),e.closePath(),e.stroke(),e.save(),e.fillStyle=O._fillColor,e.globalCompositeOperation="destination-over",e.beginPath(),e.moveTo(t,r+O._bevelSize),e.lineTo(t,r+i-O._bevelSize),e.lineTo(t+O._bevelSize,r+i),e.lineTo(t+n-O._bevelSize,r+i),e.lineTo(t+n,r+i-O._bevelSize),e.lineTo(t+n,r+O._bevelSize),e.lineTo(t+n-O._bevelSize,r),e.lineTo(t+O._bevelSize,r),e.closePath(),e.fill(),e.restore()}}function z(e){if(e){let t=e.firstElementChild;for(;t;)t.remove(),t=e.firstElementChild}}function H(e){const t=e.split(".");return t.length>1?t[t.length-1]:""}O._res=144,O._margin=0,O._bevelSize=15,O._blackColor="#1d272a",O._grey1="#b3bbb5",O._greyLight="#dde1df",O._fillColor="#f6f6f6",O._unitLabels=["UNIT","MOVE","WOUNDS","BRAVERY","SAVE"],O._weaponLabels=["MISSILE WEAPONS","RANGE","ATTACKS","TO HIT","TO WOUND","REND","DAMAGE"],O._meleeLabels=["MELEE WEAPONS","RANGE","ATTACKS","TO HIT","TO WOUND","REND","DAMAGE"],O._spellLabels=["SPELL","CASTING VALUE","DESCRIPTION"],O._prayerLabels=["PRAYER","DESCRIPTION"];const P=document.getElementById("roster-file");P&&P.addEventListener("change",(function(e){const t=e.target.files;if(z(document.getElementById("roster-title")),z(document.getElementById("roster-lists")),z(document.getElementById("force-units")),t){for(let e of t){"rosz"==H(e.name)&&console.log("Got zipped file.");const t=new FileReader;t.onload=function(e){var t;const r=e.target;if(r&&r.result){let e=r.result;const n=e.toString().indexOf(",")+1,i=window.atob(e.toString().slice(n));let s=(new DOMParser).parseFromString(i,"text/xml");if(s){let e=s.querySelector("roster");if(e){const r=null===(t=e.getAttributeNode("gameSystemName"))||void 0===t?void 0:t.nodeValue;if(!r)return;const n=document.getElementById("roster-title"),i=document.getElementById("roster-lists"),o=document.getElementById("force-units");if("Warhammer 40,000 8th Edition"==r){let e=u(s);if(e&&e._forces.length>0){new T(e).render(n,i,o)}}else if("Warhammer 40,000: Kill Team (2018)"==r){let e=u(s,!1);if(e&&e._forces.length>0){new T(e).render(n,i,o)}}else if("Age of Sigmar"==r){let e=k(s);if(e){new O(e).render(n,i,o)}}}}}},t.readAsDataURL(e)}}}),!1)}]);